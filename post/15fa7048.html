<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ROS | 醉卿枫の博客</title><meta name="author" content="醉卿枫"><meta name="copyright" content="醉卿枫"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="第一章 ROS的概述与环境搭建 古月21讲笔记 无人机仿真 ros ros wiki中文版 ros_api包：可在上面查看软件包及消息类型  ROS 概念 ros教程完整节点（Node）— 执行单元 节点是具体的执行单元，执行具体任务的进程，独立运行的可执行文件 不同的节点可以使用不同的编程语言，可分布式运行在不同的主机 节点在系统中的名称必须是唯一的，重名ros系统会找不到  节点管理器（RO">
<meta property="og:type" content="article">
<meta property="og:title" content="ROS">
<meta property="og:url" content="https://github.com/wjl-a/data.github.io/post/15fa7048.html">
<meta property="og:site_name" content="醉卿枫の博客">
<meta property="og:description" content="第一章 ROS的概述与环境搭建 古月21讲笔记 无人机仿真 ros ros wiki中文版 ros_api包：可在上面查看软件包及消息类型  ROS 概念 ros教程完整节点（Node）— 执行单元 节点是具体的执行单元，执行具体任务的进程，独立运行的可执行文件 不同的节点可以使用不同的编程语言，可分布式运行在不同的主机 节点在系统中的名称必须是唯一的，重名ros系统会找不到  节点管理器（RO">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://bu.dusays.com/2022/05/26/628fa0426213d.png">
<meta property="article:published_time" content="2023-07-28T16:00:00.000Z">
<meta property="article:modified_time" content="2024-01-14T03:21:05.417Z">
<meta property="article:author" content="醉卿枫">
<meta property="article:tag" content="ROS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://bu.dusays.com/2022/05/26/628fa0426213d.png"><link rel="shortcut icon" href="/data.github.io/img/favicon.png"><link rel="canonical" href="https://github.com/wjl-a/data.github.io/post/15fa7048.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/data.github.io/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/data.github.io/',
  algolia: undefined,
  localSearch: {"path":"/data.github.io/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体中文","cht_to_chs":"你已切换为简体中文","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ROS',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-01-14 11:21:05'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.0.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (true) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://wjlpicture.oss-cn-beijing.aliyuncs.com/img/12.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/data.github.io/archives/"><div class="headline">文章</div><div class="length-num">38</div></a><a href="/data.github.io/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/data.github.io/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/data.github.io/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/data.github.io/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/data.github.io/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/data.github.io/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/data.github.io/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/data.github.io/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/data.github.io/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://bu.dusays.com/2022/05/26/628fa0426213d.png')"><nav id="nav"><span id="blog-info"><a href="/data.github.io/" title="醉卿枫の博客"><span class="site-name">醉卿枫の博客</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/data.github.io/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/data.github.io/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/data.github.io/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/data.github.io/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/data.github.io/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/data.github.io/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/data.github.io/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ROS</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-07-28T16:00:00.000Z" title="发表于 2023-07-29 00:00:00">2023-07-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-14T03:21:05.417Z" title="更新于 2024-01-14 11:21:05">2024-01-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/data.github.io/categories/ROS/">ROS</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">8.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>36分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ROS"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42257666/article/details/119209599?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169103195516800211577632%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=169103195516800211577632&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-119209599-null-null.142%5Ev92%5Econtrol&utm_term=ros%E6%95%99%E7%A8%8B&spm=1018.2226.3001.4187">第一章 ROS的概述与环境搭建</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43455581/article/details/96306977?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169227833916800180633932%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=169227833916800180633932&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-96306977-null-null.142%5Ev93%5EchatgptT3_2&utm_term=%E5%8F%A4%E6%9C%88%E5%B1%85ros%E5%85%A5%E9%97%A821%E8%AE%B2%E7%AC%94%E8%AE%B0&spm=1018.2226.3001.4187#t7">古月21讲笔记</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_37680545/article/details/123243313">无人机仿真</a></li>
<li><a target="_blank" rel="noopener" href="https://www.guyuehome.com/372">ros</a></li>
<li><a target="_blank" rel="noopener" href="https://wiki.ros.org/cn">ros wiki中文版</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.ros.org/en/api/">ros_api包</a>：可在上面查看软件包及消息类型</li>
</ul>
<h1 id="ROS-概念"><a href="#ROS-概念" class="headerlink" title="ROS 概念"></a>ROS 概念</h1><ul>
<li><a target="_blank" rel="noopener" href="http://www.autolabor.com.cn/book/ROSTutorials/di-2-zhang-ros-jia-gou-she-ji.html">ros教程完整</a><br><strong>节点（Node）— 执行单元</strong></li>
<li>节点是具体的执行单元，执行具体任务的进程，独立运行的可执行文件</li>
<li>不同的节点可以使用不同的编程语言，可分布式运行在不同的主机</li>
<li>节点在系统中的名称必须是唯一的，重名ros系统会找不到</li>
</ul>
<p><strong>节点管理器（ROS Master) — 控制中心</strong></p>
<ul>
<li>节点的管理。命名、注册、建立通讯</li>
<li>提供参数服务器，节点使用此服务器存储和检索运行时的参数</li>
</ul>
<p><strong>话题通信（异步）<br>话题 topic</strong></p>
<ul>
<li>分为发布者和订阅者</li>
<li>单向数据传输，从驱动端传到订阅段，发布者到订阅者</li>
<li>通道被定义为话题时,数据传输的总线</li>
</ul>
<p><strong>消息 message</strong></p>
<ul>
<li>具有一定的类型和数据结构（有 ros 提供的标准类型和用户自定义的类型）</li>
<li>使用与编程语言无关的 .msg 文件定义类型和数据结构</li>
</ul>
<p><strong>服务通信（同步）<br>服务 service</strong></p>
<ul>
<li>使用服务端&#x2F;客服端（service&#x2F;client) 模型，客户端发送请求数据，服务器完成处理后返回应答数据</li>
<li>使用与编程语言无关的, .srv 文件定义请求和应答的数据结构</li>
<li>一般是一次，发出一个配置指令，完成配置内容，返回一个反馈</li>
</ul>
<p>![[Pasted image 20230818085619.png]]<br>![[Pasted image 20230818085629.png]]<br><strong>参数 parameter</strong></p>
<ul>
<li>适合存储静态、非二进制的配置参数，不适合动态配置的数据</li>
<li>节点使用服务器来存储和检测运行时的参数</li>
</ul>
<p><strong>文件系统</strong></p>
<ul>
<li>功能包 package：ros软件的基本单元，包含源码、配置文件、数据定义</li>
<li>功能包清单 package manifest：记录功能包的基本信息，包含作者信息、许可信息等等信息</li>
<li>元功能包 meta packages：组织多个用于同一目的的功能</li>
</ul>
<h2 id="ROS-搞懂多话题回调机制以及消息队列"><a href="#ROS-搞懂多话题回调机制以及消息队列" class="headerlink" title="ROS 搞懂多话题回调机制以及消息队列"></a>ROS 搞懂多话题回调机制以及消息队列</h2><ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_67392931/article/details/123498349?spm=1001.2101.3001.6650.8&utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-8-123498349-blog-113934774.235%5Ev38%5Epc_relevant_anti_t3&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-8-123498349-blog-113934774.235%5Ev38%5Epc_relevant_anti_t3&utm_relevant_index=16">来源</a></li>
<li>ROS话题的通信是<strong>异步</strong>的，publisher只管不停的发但不管是否被接收，publisher的消息队列就是publisher发布信息的地方</li>
<li>publisher向消息队列发布信息然后通知subscriber过来读取， 而并不是publisher直接push给subscriber，publisher不停将消息发布到消息队列上，直到队列占满，然后新到的消息把最老的消息挤出队列，每个subscriber会通过一个位置指针使其在正确的消息队列位置上进行读取</li>
<li>publisher消息队列的作用就是，缓存一定数量的历史信息，让不能及时订阅的subscriber能读取到之前发布的信息</li>
<li>subscriber读取到数据后就会将它放置与自己的消息队列中，等待回调函数读取，这个消息队列的作用是，将回调函数来不及处理的信息及时的缓存，这样不至于因为回调函数执行或调用过慢，导致数据的丢失。</li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/liu-fa/p/5925381.html">ROS处理回调函数</a></li>
<li>接受订阅的消息，但是<strong>所接到的消息并不是立刻就被处理，而是必须要等到ros::spin()或ros::spinOnce()执行的时候才被调用</strong>，这就是消息回到函数的原理</li>
</ul>
<p><strong>区别</strong></p>
<ul>
<li>ros::spin()：调用后不会执行后面的程序，一般在程序结束末尾</li>
<li>ros::spinOnce()：调用<strong>后还可以继续执行之后的程序</strong><ul>
<li>ros::spinOnce()的用法相对来说很灵活，但往往需要考虑调用消息的时机，调用频率，以及消息池的大小，这些都要根据现实情况协调好，不然会造成数据丢包或者延迟的错误。</li>
</ul>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//订阅时的回调函数，接受到该消息体的内容时执行里面的内容，这里面的内容就是赋值</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">state_cb</span><span class="params">(<span class="type">const</span> mavros_msgs::State::ConstPtr&amp; msg)</span></span>&#123;</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;TEST&quot;</span>);</span><br><span class="line">    current_state = *msg;</span><br><span class="line">&#125;</span><br><span class="line">ros::Subscriber state_sub = nh.<span class="built_in">subscribe</span>&lt;mavros_msgs::State&gt;(<span class="string">&quot;mavros/state&quot;</span>, <span class="number">100</span>, state_cb);</span><br><span class="line"><span class="function">ros::Rate <span class="title">rate</span><span class="params">(<span class="number">15.0</span>)</span></span>;<span class="comment">//利用rate.sleep()控制while循环的每秒运行15次</span></span><br><span class="line"><span class="keyword">while</span>(ros::<span class="built_in">ok</span>())<span class="comment">//进入大循环</span></span><br><span class="line">    &#123;</span><br><span class="line">        ....</span><br><span class="line">         local_pos_pub.<span class="built_in">publish</span>(pose); <span class="comment">//发布位置信息，所以综上飞机只有先打开offboard模式然后解锁才能飞起来</span></span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;spinOnce&quot;</span>);</span><br><span class="line">        ros::<span class="built_in">spinOnce</span>();</span><br><span class="line">        rate.<span class="built_in">sleep</span>();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//对于上述测试的代码</span></span><br></pre></td></tr></table></figure>

<h2 id="ROS时间概念"><a href="#ROS时间概念" class="headerlink" title="ROS时间概念"></a>ROS时间概念</h2><ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/u014453443/article/details/104636566">概念总结</a><br><strong>基本用法</strong><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取当前时间</span></span><br><span class="line">ros::Time begin=ros::Time::<span class="built_in">now</span>();   </span><br><span class="line"> </span><br><span class="line"><span class="comment">//定义类对象</span></span><br><span class="line">ros::Time::<span class="built_in">Time</span>(<span class="type">uint32_t</span> sec, <span class="type">uint32_t</span> nsec)</span><br><span class="line">ros::Time::<span class="built_in">Time</span>(<span class="type">double</span> t)</span><br><span class="line"> </span><br><span class="line">ros::Duration::<span class="built_in">Duration</span>(<span class="type">uint32_t</span> sec, <span class="type">uint32_t</span> nsec)</span><br><span class="line">ros::Duration::<span class="built_in">Duration</span>(<span class="type">double</span> t)</span><br><span class="line"><span class="comment">//_sec是秒，_nsec是纳秒</span></span><br><span class="line"><span class="comment">//故ros::Time a_little_after_the_beginning(0, 1000000);等价于ros::Time a_little_after_the_beginning(0.001);</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//实列</span></span><br><span class="line"><span class="function">ros::Time <span class="title">at_some_time1</span><span class="params">(<span class="number">5</span>,<span class="number">20000000</span>)</span></span>;    <span class="comment">//逗号之前表示 second，逗号之后表示 nanosecond</span></span><br><span class="line"><span class="function">ros::Time <span class="title">at_some_time2</span><span class="params">(<span class="number">5.2</span>)</span>    <span class="comment">//同上,重载了float类型和两个uint类型的构造函数</span></span></span><br><span class="line"><span class="function">ros::Duration <span class="title">one_hour</span><span class="params">(<span class="number">60</span>*<span class="number">60</span>,<span class="number">0</span>)</span></span>; <span class="comment">//1h</span></span><br><span class="line"><span class="type">double</span> secs1=at_some_time1.<span class="built_in">toSec</span>();<span class="comment">//将 Time 转为 double 型时间</span></span><br><span class="line"><span class="type">double</span> secs2=one_hour.<span class="built_in">toSec</span>();<span class="comment">//将 Duration 转为 double 型时间</span></span><br></pre></td></tr></table></figure></li>
<li>Time 指的是某个时刻，而 Duration 指的是某个时段，尽管他们的数据结构都相同，但是应该用在不同的场景下</li>
<li>ROS为我们重载了 Time、Duration 类型之间的加减运算，避免了转换的麻烦。</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ros::Time t1=ros::Time::now()-ros::Duration(<span class="number">5.5</span>);<span class="comment">//t1是5.5s前的时刻,Time加减Duration返回Time</span></span><br><span class="line">ros::Time t2=ros::Time::now()+ros::Duration(<span class="number">3.3</span>);<span class="comment">//t2是当前时刻往后推3.3s的时刻</span></span><br><span class="line">ros::Duration d1=t2-t1;<span class="comment">//从t1到t2的时长，两个Time相减返回Duration类型</span></span><br><span class="line">ros::Duration d2=d1-ros::Duration(<span class="number">0</span>,<span class="number">300</span>);<span class="comment">//两个Duration相减，返回Duration</span></span><br></pre></td></tr></table></figure>
<h1 id="ROS-命令行工具的使用（操作集）"><a href="#ROS-命令行工具的使用（操作集）" class="headerlink" title="ROS 命令行工具的使用（操作集）"></a>ROS 命令行工具的使用（操作集）</h1><p>这需要新建多个终端并输入命令</p>
<ul>
<li>启动 rosmaster：<code>roscore</code></li>
<li>启动小海龟仿真器：<code>rosrun turtlesim turtlesim_node</code></li>
<li>启动海龟控制节点：<code>rosrun turtlesim turtle_teleop_key</code>，点击该终端可以通过键盘运行小海龟</li>
<li><code>rosrun  [包名] [可执行文件]</code><ul>
<li>可执行文件一般是src文件下的cpp文件处理后的，需要在CMakeLists中去设置好可执行文件</li>
</ul>
</li>
</ul>
<h2 id="ros文件系统"><a href="#ros文件系统" class="headerlink" title="ros文件系统"></a>ros文件系统</h2><p><strong>catkin结构</strong></p>
<p>![[Pasted image 20231112120357.png]]</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">​&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!-- 格式: 以前是 1，推荐使用格式 2 --&gt;</span><br><span class="line">&lt;package format=&quot;2&quot;&gt;</span><br><span class="line">  &lt;!-- 包名 --&gt;</span><br><span class="line">  &lt;name&gt;demo01_hello_vscode&lt;/name&gt;</span><br><span class="line">  &lt;!-- 版本 --&gt;</span><br><span class="line">  &lt;version&gt;0.0.0&lt;/version&gt;</span><br><span class="line">  &lt;!-- 描述信息 --&gt;</span><br><span class="line">  &lt;description&gt;The demo01_hello_vscode package&lt;/description&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- One maintainer tag required, multiple allowed, one person per tag --&gt;</span><br><span class="line">  &lt;!-- Example:  --&gt;</span><br><span class="line">  &lt;!-- &lt;maintainer email=&quot;jane.doe@example.com&quot;&gt;Jane Doe&lt;/maintainer&gt; --&gt;</span><br><span class="line">  &lt;!-- 维护人员 --&gt;</span><br><span class="line">  &lt;maintainer email=&quot;xuzuo@todo.todo&quot;&gt;xuzuo&lt;/maintainer&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;!-- One license tag required, multiple allowed, one license per tag --&gt;</span><br><span class="line">  &lt;!-- Commonly used license strings: --&gt;</span><br><span class="line">  &lt;!--   BSD, MIT, Boost Software License, GPLv2, GPLv3, LGPLv2.1, LGPLv3 --&gt;</span><br><span class="line">  &lt;!-- 许可证信息，ROS核心组件默认 BSD --&gt;</span><br><span class="line">  &lt;license&gt;TODO&lt;/license&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;!-- Url tags are optional, but multiple are allowed, one per tag --&gt;</span><br><span class="line">  &lt;!-- Optional attribute type can be: website, bugtracker, or repository --&gt;</span><br><span class="line">  &lt;!-- Example: --&gt;</span><br><span class="line">  &lt;!-- &lt;url type=&quot;website&quot;&gt;http://wiki.ros.org/demo01_hello_vscode&lt;/url&gt; --&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;!-- Author tags are optional, multiple are allowed, one per tag --&gt;</span><br><span class="line">  &lt;!-- Authors do not have to be maintainers, but could be --&gt;</span><br><span class="line">  &lt;!-- Example: --&gt;</span><br><span class="line">  &lt;!-- &lt;author email=&quot;jane.doe@example.com&quot;&gt;Jane Doe&lt;/author&gt; --&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;!-- The *depend tags are used to specify dependencies --&gt;</span><br><span class="line">  &lt;!-- Dependencies can be catkin packages or system dependencies --&gt;</span><br><span class="line">  &lt;!-- Examples: --&gt;</span><br><span class="line">  &lt;!-- Use depend as a shortcut for packages that are both build and exec dependencies --&gt;</span><br><span class="line">  &lt;!--   &lt;depend&gt;roscpp&lt;/depend&gt; --&gt;</span><br><span class="line">  &lt;!--   Note that this is equivalent to the following: --&gt;</span><br><span class="line">  &lt;!--   &lt;build_depend&gt;roscpp&lt;/build_depend&gt; --&gt;</span><br><span class="line">  &lt;!--   &lt;exec_depend&gt;roscpp&lt;/exec_depend&gt; --&gt;</span><br><span class="line">  &lt;!-- Use build_depend for packages you need at compile time: --&gt;</span><br><span class="line">  &lt;!--   &lt;build_depend&gt;message_generation&lt;/build_depend&gt; --&gt;</span><br><span class="line">  &lt;!-- Use build_export_depend for packages you need in order to build against this package: --&gt;</span><br><span class="line">  &lt;!--   &lt;build_export_depend&gt;message_generation&lt;/build_export_depend&gt; --&gt;</span><br><span class="line">  &lt;!-- Use buildtool_depend for build tool packages: --&gt;</span><br><span class="line">  &lt;!--   &lt;buildtool_depend&gt;catkin&lt;/buildtool_depend&gt; --&gt;</span><br><span class="line">  &lt;!-- Use exec_depend for packages you need at runtime: --&gt;</span><br><span class="line">  &lt;!--   &lt;exec_depend&gt;message_runtime&lt;/exec_depend&gt; --&gt;</span><br><span class="line">  &lt;!-- Use test_depend for packages you need only for testing: --&gt;</span><br><span class="line">  &lt;!--   &lt;test_depend&gt;gtest&lt;/test_depend&gt; --&gt;</span><br><span class="line">  &lt;!-- Use doc_depend for packages you need only for building documentation: --&gt;</span><br><span class="line">  &lt;!--   &lt;doc_depend&gt;doxygen&lt;/doc_depend&gt; --&gt;</span><br><span class="line">  &lt;!-- 依赖的构建工具，这是必须的 --&gt;</span><br><span class="line">  &lt;buildtool_depend&gt;catkin&lt;/buildtool_depend&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- 指定构建此软件包所需的软件包 --&gt;</span><br><span class="line">  &lt;build_depend&gt;roscpp&lt;/build_depend&gt;</span><br><span class="line">  &lt;build_depend&gt;rospy&lt;/build_depend&gt;</span><br><span class="line">  &lt;build_depend&gt;std_msgs&lt;/build_depend&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- 指定根据这个包构建库所需要的包 --&gt;</span><br><span class="line">  &lt;build_export_depend&gt;roscpp&lt;/build_export_depend&gt;</span><br><span class="line">  &lt;build_export_depend&gt;rospy&lt;/build_export_depend&gt;</span><br><span class="line">  &lt;build_export_depend&gt;std_msgs&lt;/build_export_depend&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- 运行该程序包中的代码所需的程序包 --&gt;  </span><br><span class="line">  &lt;exec_depend&gt;roscpp&lt;/exec_depend&gt;</span><br><span class="line">  &lt;exec_depend&gt;rospy&lt;/exec_depend&gt;</span><br><span class="line">  &lt;exec_depend&gt;std_msgs&lt;/exec_depend&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;!-- The export tag contains other, unspecified, tags --&gt;</span><br><span class="line">  &lt;export&gt;</span><br><span class="line">    &lt;!-- Other tools can request additional information be placed here --&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/export&gt;</span><br><span class="line">&lt;/package&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>![[Pasted image 20231213092328.png]]<br><strong>package是catkin工作空间的基本单元</strong></p>
<ul>
<li>其中定义package的是 CMakeLists.txt 和 package.xml ,这两个文件是package中必不可少<br>![[Pasted image 20231031195234.png]]<br>• scripts (python 可执行文件)<br>• src (C++ source files)<br>• msg (for custom message definitions)<br>• srv (for service message definitions)<br>• include -&gt; 需要作为依赖项的头&#x2F;库<br>• config -&gt; 配置文件<br>• launch -&gt; 提供更自动化的启动节点方式<br>• urdf (通用机器人描述文件)<br>• meshes (CAD文件.dae (Collada)或.stl (STereoLithography)格式)<br>• worlds (用于Gazebo模拟环境的类似XML的文件)</li>
</ul>
<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rqt_graph  <span class="comment">//用来显示系统计算图的工具</span></span><br></pre></td></tr></table></figure>
<h3 id="rosnode"><a href="#rosnode" class="headerlink" title="rosnode"></a>rosnode</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rosnode  <span class="comment">//显示所有系统节点相关信息的指令</span></span><br><span class="line">rosnode <span class="built_in">list</span> <span class="comment">//列出系统所有节点</span></span><br><span class="line">rosnode info 节点 <span class="comment">//查看节点信息，查看某个节点的信息，发布和订阅的信息</span></span><br></pre></td></tr></table></figure>

<h3 id="rostopic"><a href="#rostopic" class="headerlink" title="rostopic"></a>rostopic</h3><ul>
<li><a target="_blank" rel="noopener" href="http://www.autolabor.com.cn/book/ROSTutorials/di-2-zhang-ros-jia-gou-she-ji/24-chang-yong-ming-ling/242-rostopic.html">简单说明</a><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rostopic bw     显示主题使用的带宽</span><br><span class="line">rostopic delay  显示带有 header 的主题延迟</span><br><span class="line">rostopic echo   打印消息到屏幕</span><br><span class="line">rostopic find   根据类型查找主题</span><br><span class="line">rostopic hz     显示主题的发布频率</span><br><span class="line">rostopic info   显示主题相关信息</span><br><span class="line">rostopic list   显示所有活动状态下的主题</span><br><span class="line">rostopic pub    将数据发布到主题</span><br><span class="line">rostopic type   打印主题类型</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>rostopic list</strong></p>
<ul>
<li>直接调用即可，控制台将打印当前运行状态下的主题名称</li>
<li>rostopic list -v : 获取话题详情(比如列出：发布者和订阅者个数…)</li>
</ul>
<p><strong>rostopic pub</strong></p>
<ul>
<li>可以直接调用命令向订阅者发布消息</li>
<li>为roboware 自动生成的 发布&#x2F;订阅 模型案例中的 订阅者 发布一条字符串<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rostopic pub /主题名称 消息类型 消息内容</span><br><span class="line">rostopic pub /chatter std_msgs gagaxixi</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>rostpic echo</strong>  主题名称</p>
<ul>
<li>获取指定话题当前发布的消息</li>
</ul>
<p><strong>rostopic info</strong>  主题名称</p>
<ul>
<li>获取当前话题的相关信息</li>
<li>消息类型</li>
<li>发布者信息</li>
<li>订阅者信息<br><strong>rostopic type</strong></li>
<li>列出话题的消息类型<br><strong>rostopic find 消息类型</strong></li>
<li>根据消息类型查找话题</li>
</ul>
<p><strong>rostopic delay</strong></p>
<ul>
<li>列出消息头信息</li>
</ul>
<p><strong>rostopic hz</strong></p>
<ul>
<li>列出消息发布频率</li>
</ul>
<p><strong>rostopic bw</strong></p>
<ul>
<li>列出消息发布带宽</li>
</ul>
<p>![[Pasted image 20230818095944.png]]<br>学会使用tab, 这里输入消息类型的时候还要连按两次tab（通过两次tab键来补全命令）</p>
<ul>
<li>用pub发布数据给某一个topic</li>
<li>后面跟话题名</li>
<li>再后面跟消息结构（类型）</li>
<li>再跟消息结构里的具体数据</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这是发布线速度和角速度的命令，这样只运行一次</span></span><br><span class="line"><span class="comment">//rostopic pub 话题名称  消息类型 消息内容</span></span><br><span class="line">rostopic pub /turtle1/cmd_vel geometry_msgs/Twist <span class="string">&quot;linear:</span></span><br><span class="line"><span class="string">  x: 1.0</span></span><br><span class="line"><span class="string">  y: 0.0</span></span><br><span class="line"><span class="string">  z: 4.0</span></span><br><span class="line"><span class="string">angular:</span></span><br><span class="line"><span class="string">  x: 54.0</span></span><br><span class="line"><span class="string">  y: 0.0</span></span><br><span class="line"><span class="string">  z: 0.0&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">//一秒钟发布2次</span></span><br><span class="line">rostopic pub -r <span class="number">2</span> /turtle1/cmd_vel geometry_msgs/Twist <span class="string">&quot;linear:</span></span><br><span class="line"><span class="string">  x: 1.0</span></span><br><span class="line"><span class="string">  y: 0.0</span></span><br><span class="line"><span class="string">  z: 4.0</span></span><br><span class="line"><span class="string">angular:</span></span><br><span class="line"><span class="string">  x: 54.0</span></span><br><span class="line"><span class="string">  y: 0.0</span></span><br><span class="line"><span class="string">  z: 0.0&quot;</span> </span><br></pre></td></tr></table></figure>

<h3 id="rosmsg"><a href="#rosmsg" class="headerlink" title="rosmsg"></a>rosmsg</h3><ul>
<li>rosmsg show显示消息的数据结构<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rosmsg</span><br><span class="line">rosmsg show geometry_msgs/Twist</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="rosservice"><a href="#rosservice" class="headerlink" title="rosservice"></a>rosservice</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rosservice   <span class="comment">//查看相关服务端相关指令</span></span><br><span class="line">rosservice list</span><br></pre></td></tr></table></figure>

<p>rosservice call 召唤新海龟</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rosservice call /spawn <span class="string">&quot;x: 2.0</span></span><br><span class="line"><span class="string">y: 2.0</span></span><br><span class="line"><span class="string">theta: 0.0</span></span><br><span class="line"><span class="string">name: &#x27;turtle2&#x27;&quot;</span> </span><br></pre></td></tr></table></figure>

<h3 id="rosbag"><a href="#rosbag" class="headerlink" title="rosbag"></a>rosbag</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rosbag record -a -O cmd_record    <span class="comment">//话题记录,将记录cmd_record.bag并保存到当前目录</span></span><br><span class="line">rosbag play cmd_record.bag        <span class="comment">//对上面的记录的话题，进行话题复现</span></span><br></pre></td></tr></table></figure>
<h1 id="创建工作空间与功能包"><a href="#创建工作空间与功能包" class="headerlink" title="创建工作空间与功能包"></a>创建工作空间与功能包</h1><p><strong>概念</strong></p>
<ul>
<li>工作空间（workspace)是一个存放工程开发相关文件的文件夹。所有的源码、配置文件、可执行文件都是放置在里面的。主要分为四个文件夹：</li>
</ul>
<ol>
<li>src: 代码空间 (source space)：放置功能包（里面的代码、配置文件、launch文件</li>
<li>build:编译空间 (build space)：编译过程中的中间文件（不太用关心</li>
<li>devel:开发空间 (development space)：编译生成的一些可执行文件、库、脚本</li>
<li>install:安装空间 (install space)：install命令的结果就放在里面<br>![[Pasted image 20230818165821.png]]<br><strong>创建工作空间</strong><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/catkin_ws/src   <span class="comment">//-p是连续创建，catkin_ws可以是其他名字，src必须有</span></span><br><span class="line">cd ~/catkin_ws/src</span><br><span class="line">catkin_init_workspace</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>编译工作空间</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd ~/catkin_ws/</span><br><span class="line">catkin_make </span><br><span class="line">catkin_make install   <span class="comment">//使install空间出现</span></span><br></pre></td></tr></table></figure>

<p><strong>创建功能包</strong></p>
<ul>
<li>功能包是放置ROS源码的最小单元</li>
<li>同一个工作空间下不允许存在同名功能包</li>
<li>要在src里面<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/23227ad21b774a298d8e3eb2431345a4.png" alt="在这里插入图片描述"><br>命令 功能包名 依赖1 依赖2 依赖3 … 依赖n：<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建功能包,功能包名可自定义</span></span><br><span class="line">cd ~/catkin_ws/src</span><br><span class="line">catkin_create_pkg test_pkg std_msgs rospy roscpp  <span class="comment">//有cpp，python依赖</span></span><br><span class="line"><span class="comment">//编译功能包</span></span><br><span class="line">cd ~/catkin_ws</span><br><span class="line">catkin_make </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<strong>设置环境变量</strong></li>
<li>在catkin_ws的文件下设置：<code>source devel/setup.bash</code></li>
</ul>
<p><strong>检查环境变量</strong></p>
<ul>
<li>用echo命令把环境变量打开:<code>echo $ROS_PACKAGE_PATH</code>,（ROS_PACKAGE_PATH 是ROS本身的一个环境变量，通过这个环境变量查找所有功能包的路径）</li>
</ul>
<h4 id="catkin-make和catkin-build区别"><a href="#catkin-make和catkin-build区别" class="headerlink" title="catkin_make和catkin build区别"></a>catkin_make和catkin build区别</h4><ul>
<li>catkin_make会编译全部ros包</li>
<li>而catkin_build可以选择部分ros包编译<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//只编译uav_arm包</span></span><br><span class="line">catkin build uav_arm</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="发布实现"><a href="#发布实现" class="headerlink" title="发布实现"></a>发布实现</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_46980810/article/details/133691753?ops_request_misc=&request_id=&biz_id=102&utm_term=ros%E8%AE%A2%E9%98%85%E8%AF%9D%E9%A2%98%E6%A1%88%E4%BE%8B%E3%80%91&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-133691753.nonecase&spm=1018.2226.3001.4187">订阅与发布讲解</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在src下创建包,并编译</span></span><br><span class="line">cd ~/catkin_ws/src</span><br><span class="line">catkin_create_pkg learning_topic roscpp rospy std_msgs geometry_msgs turtlesim</span><br><span class="line">cd ~/catkin_ws/</span><br><span class="line">catkin_make</span><br></pre></td></tr></table></figure>
<p>![[Pasted image 20230818141307.png]]<br>在<code>src/learning_topic/src</code>下创建文件<code>velocity_publisher.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程将发布turtle1/cmd_vel话题，消息类型geometry_msgs::Twist</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;geometry_msgs/Twist.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// ROS节点初始化</span></span><br><span class="line">	ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;velocity_publisher&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建节点句柄</span></span><br><span class="line">	ros::NodeHandle n;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建一个Publisher，发布名为/turtle1/cmd_vel的topic，消息类型为geometry_msgs::Twist，队列长度10</span></span><br><span class="line">	ros::Publisher turtle_vel_pub = n.<span class="built_in">advertise</span>&lt;geometry_msgs::Twist&gt;(<span class="string">&quot;/turtle1/cmd_vel&quot;</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置循环的频率</span></span><br><span class="line">	<span class="function">ros::Rate <span class="title">r</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在<code>src/learning_topic/CMakeLists.txt</code>中的camke文件添加信息</p>
<h3 id="cmake文件"><a href="#cmake文件" class="headerlink" title="cmake文件"></a>cmake文件</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在build注释后面添加</span></span><br><span class="line"><span class="keyword">add_executable</span>(velocity_publisher src/velocity_publisher.cpp)<span class="comment">#描述将cpp变成velocity_publisher可执行文件,这里添加编译文件名的名称</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(velocity_publisher <span class="variable">$&#123;catkin_LIBRARIES&#125;</span>)<span class="comment">#指定库以链接库或可执行目标</span></span><br></pre></td></tr></table></figure>

<p>接着返回根目录编译</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">catkin_make</span><br><span class="line">source devel/setup.bash  <span class="comment">#设置环境变量</span></span><br></pre></td></tr></table></figure>

<p>运行发布</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">roscore </span><br><span class="line">rosrun turtlesim turtlesim_node</span><br><span class="line">rosrun learning_topic velocity_publisher</span><br></pre></td></tr></table></figure>
<ul>
<li>注意<code>source devel/setup.bash</code>和<code>rosrun learning_topic velocity_publisher</code>要在同一个终端才不会报错，<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_33973712/article/details/108226729?ops_request_misc=&request_id=&biz_id=102&utm_term=%5Brospack%5D%20Error:%20package%20%27lear&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-108226729.142%5Ev93%5EchatgptT3_2&spm=1018.2226.3001.4187">解决报错办法</a></li>
</ul>
<h2 id="订阅者实现"><a href="#订阅者实现" class="headerlink" title="订阅者实现"></a>订阅者实现</h2><ul>
<li>对于已经创建的环境包中实现，在<code>src/learning_topic/src</code>下创建文件<code>pose_subscriber.cpp</code></li>
<li>同一个回调函数可以在多个订阅话题中使用</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程将订阅/turtle1/pose话题，消息类型turtlesim::Pose</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;turtlesim/Pose.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收到订阅的消息后，会进入消息回调函数，订阅消息的操作需要在回调函数中去写</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">poseCallback</span><span class="params">(<span class="type">const</span> turtlesim::Pose::ConstPtr&amp; msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 将接收到的消息打印出来</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Turtle pose: x:%0.6f, y:%0.6f&quot;</span>, msg-&gt;x, msg-&gt;y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 初始化ROS节点</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;pose_subscriber&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个Subscriber，订阅名为/turtle1/pose的topic，注册回调函数poseCallback</span></span><br><span class="line">    ros::Subscriber pose_sub = n.<span class="built_in">subscribe</span>&lt;turtlesim::Pose::ConstPtr&gt;(<span class="string">&quot;/turtle1/pose&quot;</span>, <span class="number">10</span>, poseCallback);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环等待回调函数</span></span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ros::spin() 将会进入循环， 一直调用回调函数poseCallback(),每次调用10个数据。</span></span><br><span class="line"><span class="comment">     * 当用户输入Ctrl+C或者ROS主进程关闭时退出，</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="回调函数传入多个参数"><a href="#回调函数传入多个参数" class="headerlink" title="回调函数传入多个参数"></a>回调函数传入多个参数</h4><ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/tiderfang/p/8968124.html#:~:text=ROS%E7%BC%96%E7%A8%8B%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%81%87%E5%88%B0%E4%B8%8D%E5%B0%91%E9%9C%80%E8%A6%81%E7%BB%99%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%E4%BC%A0%E9%80%92%E5%A4%9A%E4%B8%AA%E5%8F%82%E6%95%B0%E7%9A%84%E6%83%85%E5%86%B5%EF%BC%8C%E4%B8%8B%E9%9D%A2%E6%80%BB%E7%BB%93%E4%B8%80%E4%B8%8B%EF%BC%8C%E4%BC%A0%E5%8F%82%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%9A%20%E4%B8%80%E3%80%81%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%E4%BB%85%E5%90%AB%E5%8D%95%E4%B8%AA%E5%8F%82%E6%95%B0%20void%20chatterCallback%28const%20std_msgs%3A%3AString%3A%3AConstPtr%26%20msg%29%20%7B%20ROS_INFO,%7B....%20ros%3A%3ASubscriber%20sub%20%3D%20n.subscribe%20%28%22chatter%22%2C%201000%2C%20chatterCallback%29%3B.">解释</a><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/Float64.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/Float32.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;turtlesim/Pose.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">poseCallback1</span><span class="params">(<span class="type">const</span> boost::shared_ptr&lt;<span class="type">const</span> std_msgs::Float64&gt;&amp; msg, std::string joint_name)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;%s的angle_position:%0.6f&quot;</span>, joint_name.<span class="built_in">c_str</span>(), msg-&gt;data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">poseCallback</span><span class="params">(<span class="type">const</span> boost::shared_ptr&lt;<span class="type">const</span> std_msgs::Float32&gt;&amp; msg, Four_motor&amp; four_motor)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// four_motor.Pub(msg-&gt;data);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Four_motor</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;real_position_sub&quot;</span>);</span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line">    std::string joint_name=<span class="string">&quot;1&quot;</span>;</span><br><span class="line">    ros::Subscriber arm_joint1_sub = n.<span class="built_in">subscribe</span>&lt;std_msgs::Float64&gt;(<span class="string">&quot;iris0/arm_joint1/real_position&quot;</span>, <span class="number">10</span>, boost::<span class="built_in">bind</span>(&amp;poseCallback1, _1, <span class="string">&quot;arm1&quot;</span>));</span><br><span class="line">    ros::Subscriber arm_joint2_sub = n.<span class="built_in">subscribe</span>&lt;std_msgs::Float64&gt;(<span class="string">&quot;iris0/arm_joint2/real_position&quot;</span>, <span class="number">10</span>, boost::<span class="built_in">bind</span>(&amp;poseCallback1, _1, <span class="string">&quot;arm2&quot;</span>));</span><br><span class="line">    ros::Subscriber arm_joint3_sub = n.<span class="built_in">subscribe</span>&lt;std_msgs::Float64&gt;(<span class="string">&quot;iris0/arm_joint3/real_position&quot;</span>, <span class="number">10</span>, boost::<span class="built_in">bind</span>(&amp;poseCallback1, _1, <span class="string">&quot;arm3&quot;</span>));</span><br><span class="line">    ros::Subscriber arm_joint4_sub = n.<span class="built_in">subscribe</span>&lt;std_msgs::Float64&gt;(<span class="string">&quot;iris0/arm_joint4/real_position&quot;</span>, <span class="number">10</span>, boost::<span class="built_in">bind</span>(&amp;poseCallback1, _1, <span class="string">&quot;arm4&quot;</span>));</span><br><span class="line">    Four_motor four_motor;</span><br><span class="line">    <span class="comment">// 对于定义的类,对于下面的poseCallback的第二个参数是类</span></span><br><span class="line">    ros::Subscriber pose_sub = n.<span class="built_in">subscribe</span>&lt;std_msgs::Float32&gt;(<span class="string">&quot;/var_strc_uav/four_motor_pos_sub&quot;</span>, <span class="number">10</span>,</span><br><span class="line">                                                              boost::<span class="built_in">bind</span>(&amp;poseCallback, _1, boost::<span class="built_in">ref</span>(four_motor)));</span><br><span class="line">    ros::Subscriber pose_sub = n.<span class="built_in">subscribe</span>&lt;std_msgs::Float32&gt;(<span class="string">&quot;/var_strc_uav/four_motor_pos_sub&quot;</span>, <span class="number">10</span>,</span><br><span class="line">                                                              boost::<span class="built_in">bind</span>(&amp;poseCallback, _1, four_motor));</span><br><span class="line">    <span class="comment">// 两个区别：在第一个代码片段中，使用了boost::ref(four_motor)，它将four_motor对象作为引用传递给回调函数。这意味着在回调函数中可以修改four_motor对象的状态，并且这些修改将在回调函数返回后保持有效。</span></span><br><span class="line">    <span class="comment">// 而在第二个代码片段中，使用了four_motor（而不是boost::ref(four_motor)），它将four_motor对象作为值传递给回调函数。这意味着在回调函数中对four_motor对象的修改只会在回调函数内部有效，不会影响到原始的four_motor对象。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<p>添加cmake文件中</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(pose_subscriber src/pose_subscriber.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(pose_subscriber <span class="variable">$&#123;catkin_LIBRARIES&#125;</span>)</span><br></pre></td></tr></table></figure>

<p>运行发布</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">roscore </span><br><span class="line">rosrun turtlesim turtlesim_node</span><br><span class="line">rosrun learning_topic pose_subscriber</span><br></pre></td></tr></table></figure>
<h3 id="订阅和发布混用"><a href="#订阅和发布混用" class="headerlink" title="订阅和发布混用"></a>订阅和发布混用</h3><ul>
<li>订阅一个话题，在回调函数中通过一个类来进行信息发布(发布到4个电机中)</li>
<li>测试在rqt_gui中进行发布，也可以自己写<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/Float32.h&quot;</span> </span></span><br><span class="line"><span class="comment">// 接收到订阅的消息后，会进入消息回调函数，订阅消息的操作需要在回调函数中去写</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Joint_info</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    std_msgs::Float32 joint_info;<span class="comment">//作为关节信息的发布内容</span></span><br><span class="line">    std::string topic_path;</span><br><span class="line">    std::string joint_name;</span><br><span class="line">    ros::Publisher joint_pub;</span><br><span class="line">    ros::Subscriber position_sub;</span><br><span class="line">    std_msgs::Float32 current_position;</span><br><span class="line">    <span class="built_in">Joint_info</span>()&#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Init_Info</span><span class="params">(std::string joint_name,ros::NodeHandle nh)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;joint_name=joint_name;</span><br><span class="line">        <span class="keyword">this</span>-&gt;topic_path=<span class="string">&quot;/var_strc_uav/&quot;</span>+joint_name+<span class="string">&quot;/pos_cmd&quot;</span>;<span class="comment">//设置话题路径</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;joint_pub=nh.<span class="built_in">advertise</span>&lt;std_msgs::Float32&gt;(topic_path,<span class="number">10</span>);<span class="comment">//设置节点发布</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Pub</span><span class="params">(<span class="type">double</span> data)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;current_position.data=data;</span><br><span class="line">        <span class="keyword">this</span>-&gt;joint_pub.<span class="built_in">publish</span>(<span class="keyword">this</span>-&gt;current_position);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Four_motor</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Joint_info motor1;</span><br><span class="line">    Joint_info motor2;</span><br><span class="line">    Joint_info motor3;</span><br><span class="line">    Joint_info motor4;</span><br><span class="line">    <span class="built_in">Four_motor</span>(std::string joint_name1,std::string joint_name2,std::string joint_name3,std::string joint_name4,ros::NodeHandle nh)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;motor1.<span class="built_in">Init_Info</span>(joint_name1,nh);</span><br><span class="line">        <span class="keyword">this</span>-&gt;motor2.<span class="built_in">Init_Info</span>(joint_name2,nh);</span><br><span class="line">        <span class="keyword">this</span>-&gt;motor3.<span class="built_in">Init_Info</span>(joint_name3,nh);</span><br><span class="line">        <span class="keyword">this</span>-&gt;motor4.<span class="built_in">Init_Info</span>(joint_name4,nh);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Pub</span><span class="params">(<span class="type">double</span> data)</span></span>&#123;</span><br><span class="line">        motor1.<span class="built_in">Pub</span>(data);</span><br><span class="line">        motor2.<span class="built_in">Pub</span>(data);</span><br><span class="line">        motor3.<span class="built_in">Pub</span>(data);</span><br><span class="line">        motor4.<span class="built_in">Pub</span>(data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">poseCallback</span><span class="params">(<span class="type">const</span> boost::shared_ptr&lt;<span class="type">const</span> std_msgs::Float32&gt;&amp; msg, Four_motor&amp; four_motor)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    four_motor.<span class="built_in">Pub</span>(msg-&gt;data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 初始化ROS节点</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;info_sub&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line">    <span class="function">Four_motor <span class="title">four_motor1</span><span class="params">(<span class="string">&quot;left_front_joint1&quot;</span>,<span class="string">&quot;left_hind_joint1&quot;</span>,<span class="string">&quot;right_front_joint1&quot;</span>,<span class="string">&quot;right_hind_joint1&quot;</span>,n)</span></span>;</span><br><span class="line">    <span class="function">Four_motor <span class="title">four_motor2</span><span class="params">(<span class="string">&quot;left_front_joint2&quot;</span>,<span class="string">&quot;left_hind_joint2&quot;</span>,<span class="string">&quot;right_front_joint2&quot;</span>,<span class="string">&quot;right_hind_joint2&quot;</span>,n)</span></span>;</span><br><span class="line">    <span class="comment">//对电机1的4个电机进行发布</span></span><br><span class="line">    ros::Subscriber pose_sub1 = n.<span class="built_in">subscribe</span>&lt;std_msgs::Float32&gt;(<span class="string">&quot;/var_strc_uav/four_motor1_pos_sub&quot;</span>, <span class="number">10</span>,</span><br><span class="line">                                                              boost::<span class="built_in">bind</span>(&amp;poseCallback, _1, boost::<span class="built_in">ref</span>(four_motor1)));</span><br><span class="line">    <span class="comment">//对电机2的4个电机进行发布</span></span><br><span class="line">    ros::Subscriber pose_sub2 = n.<span class="built_in">subscribe</span>&lt;std_msgs::Float32&gt;(<span class="string">&quot;/var_strc_uav/four_motor2_pos_sub&quot;</span>, <span class="number">10</span>,</span><br><span class="line">                                                              boost::<span class="built_in">bind</span>(&amp;poseCallback, _1, boost::<span class="built_in">ref</span>(four_motor2)));</span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="python实现"><a href="#python实现" class="headerlink" title="python实现"></a>python实现</h2><p><strong>流程</strong></p>
<ul>
<li>编写发布方实现；</li>
<li>编写订阅方实现；</li>
<li>为python文件添加可执行权限；</li>
<li>编辑配置文件；</li>
<li>编译并执行。</li>
</ul>
<p><strong>发布</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    需求: 实现基本的话题通信，一方发布数据，一方接收数据，</span></span><br><span class="line"><span class="string">         实现的关键点:</span></span><br><span class="line"><span class="string">         1.发送方</span></span><br><span class="line"><span class="string">         2.接收方</span></span><br><span class="line"><span class="string">         3.数据(此处为普通文本)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">         PS: 二者需要设置相同的话题</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    消息发布方:</span></span><br><span class="line"><span class="string">        循环发布信息:HelloWorld 后缀数字编号</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    实现流程:</span></span><br><span class="line"><span class="string">        1.导包 </span></span><br><span class="line"><span class="string">        2.初始化 ROS 节点:命名(唯一)</span></span><br><span class="line"><span class="string">        3.实例化 发布者 对象</span></span><br><span class="line"><span class="string">        4.组织被发布的数据，并编写逻辑发布数据</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment">#1.导包 </span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> String</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment">#2.初始化 ROS 节点:命名(唯一)</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;talker_p&quot;</span>)</span><br><span class="line">    <span class="comment">#3.实例化 发布者 对象</span></span><br><span class="line">    pub = rospy.Publisher(<span class="string">&quot;chatter&quot;</span>,String,queue_size=<span class="number">10</span>)</span><br><span class="line">    <span class="comment">#4.组织被发布的数据，并编写逻辑发布数据</span></span><br><span class="line">    msg = String()  <span class="comment">#创建 msg 对象</span></span><br><span class="line">    msg_front = <span class="string">&quot;hello 你好&quot;</span></span><br><span class="line">    count = <span class="number">0</span>  <span class="comment">#计数器 </span></span><br><span class="line">    <span class="comment"># 设置循环频率</span></span><br><span class="line">    rate = rospy.Rate(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line"></span><br><span class="line">        <span class="comment">#拼接字符串</span></span><br><span class="line">        msg.data = msg_front + <span class="built_in">str</span>(count)</span><br><span class="line"></span><br><span class="line">        pub.publish(msg)</span><br><span class="line">        rate.sleep()</span><br><span class="line">        rospy.loginfo(<span class="string">&quot;写出的数据:%s&quot;</span>,msg.data)</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>订阅</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    需求: 实现基本的话题通信，一方发布数据，一方接收数据，</span></span><br><span class="line"><span class="string">         实现的关键点:</span></span><br><span class="line"><span class="string">         1.发送方</span></span><br><span class="line"><span class="string">         2.接收方</span></span><br><span class="line"><span class="string">         3.数据(此处为普通文本)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    消息订阅方:</span></span><br><span class="line"><span class="string">        订阅话题并打印接收到的消息</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    实现流程:</span></span><br><span class="line"><span class="string">        1.导包 </span></span><br><span class="line"><span class="string">        2.初始化 ROS 节点:命名(唯一)</span></span><br><span class="line"><span class="string">        3.实例化 订阅者 对象</span></span><br><span class="line"><span class="string">        4.处理订阅的消息(回调函数)</span></span><br><span class="line"><span class="string">        5.设置循环调用回调函数</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment">#1.导包 </span></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> String</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">doMsg</span>(<span class="params">msg</span>):</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;I heard:%s&quot;</span>,msg.data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment">#2.初始化 ROS 节点:命名(唯一)</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;listener_p&quot;</span>)</span><br><span class="line">    <span class="comment">#3.实例化 订阅者 对象</span></span><br><span class="line">    sub = rospy.Subscriber(<span class="string">&quot;chatter&quot;</span>,String,doMsg,queue_size=<span class="number">10</span>)</span><br><span class="line">    <span class="comment">#4.处理订阅的消息(回调函数)</span></span><br><span class="line">    <span class="comment">#5.设置循环调用回调函数</span></span><br><span class="line">    rospy.spin()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>终端下进入 scripts 执行:<code>chmod +x ***.py</code>，编译catkin_make</li>
<li>配置CmakeLists.txt<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">catkin_install_python(PROGRAMS</span><br><span class="line">  scripts/talker_p.py</span><br><span class="line">  scripts/listener_p.py</span><br><span class="line">  DESTINATION <span class="variable">$&#123;CATKIN_PACKAGE_BIN_DESTINATION&#125;</span></span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>roscore运行，最好scripts文件下运行<code>rosrun 功能包 talker_p.py</code></li>
</ul>
<h1 id="话题消息的定义与使用"><a href="#话题消息的定义与使用" class="headerlink" title="话题消息的定义与使用"></a>话题消息的定义与使用</h1><ol>
<li>定义msg文件<br>在功能包learning_topic文件夹下新建msg文件夹,在msg下新建Person.msg文件中写入<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">string name</span><br><span class="line">uint8 sex</span><br><span class="line">uint8 age</span><br><span class="line"></span><br><span class="line">uint8 unknown=0</span><br><span class="line">uint8 male=1</span><br><span class="line">uint8 female=2</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>其中在cpp使用的类型和msg定义的类型如下</li>
<li>订阅的时候接受要用cpp对应的类型，发布时，发布的信息和发布要用msg的类型(赋值还是cpp)<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//订阅</span></span><br><span class="line">std::string current_flag;</span><br><span class="line">flag_sub=nh.<span class="built_in">subscribe</span>&lt;uav_arm::Flag&gt;(<span class="string">&quot;/&quot;</span>+model_name+<span class="string">&quot;/arm_flag&quot;</span>, <span class="number">10</span>,boost::<span class="built_in">bind</span>(&amp;Flag_judge::Flag_cb, <span class="keyword">this</span>,_1));;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Flag_cb</span><span class="params">(<span class="type">const</span> boost::shared_ptr&lt;<span class="type">const</span> uav_arm::Flag&gt;&amp; msg)</span></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        uav_arm::Flag a;</span><br><span class="line">        <span class="keyword">this</span>-&gt;current_flag=msg-&gt;flag;<span class="comment">//msg-&gt;flag</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//发布</span></span><br><span class="line">ros::Publisher flag_pub;</span><br><span class="line">flag_pub=nh.<span class="built_in">advertise</span>&lt;uav_arm::Flag&gt;(<span class="string">&quot;/&quot;</span>+model_name+<span class="string">&quot;/arm_flag&quot;</span>,<span class="number">10</span>); </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Pub</span><span class="params">(std::string a)</span></span>&#123;</span><br><span class="line">        uav_arm::Flag b;</span><br><span class="line">        b.flag=a;</span><br><span class="line">        flag_pub.<span class="built_in">publish</span>(b);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<table>
<thead>
<tr>
<th align="left">msg中类型</th>
<th align="left">cpp对应类型</th>
</tr>
</thead>
<tbody><tr>
<td align="left">float32</td>
<td align="left">float</td>
</tr>
<tr>
<td align="left">float64</td>
<td align="left">double</td>
</tr>
<tr>
<td align="left">uint8</td>
<td align="left">unsigned char</td>
</tr>
<tr>
<td align="left">uint32</td>
<td align="left">unsigned int</td>
</tr>
<tr>
<td align="left">int32</td>
<td align="left">int</td>
</tr>
<tr>
<td align="left">string</td>
<td align="left">string</td>
</tr>
<tr>
<td align="left">string</td>
<td align="left">char</td>
</tr>
<tr>
<td align="left">bool</td>
<td align="left">bool</td>
</tr>
</tbody></table>
<ol>
<li>在功能包下package.xml中添加功能包依赖<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;build_depend&gt;message_generation&lt;/build_depend&gt; <span class="comment">//编译依赖</span></span><br><span class="line">&lt;exec_depend&gt;message_runtime&lt;/exec_depend&gt;   <span class="comment">//运行依赖</span></span><br></pre></td></tr></table></figure></li>
<li>在CMakeLists.txt添加编译选项<br> 这三部分添加，第一和第三找到对应函数添加，第二个在<code>Declare ROS messages, services and actions</code> 下方添加</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(... message_generation) </span><br><span class="line"></span><br><span class="line">add_message_files(FILES Person.msg)</span><br><span class="line">generate_messages(DEPENDENCIES std_msgs)</span><br><span class="line"></span><br><span class="line">catkin_package(</span><br><span class="line"><span class="comment">#  INCLUDE_DIRS include</span></span><br><span class="line"><span class="comment">#  LIBRARIES learning_topic</span></span><br><span class="line"> CATKIN_DEPENDS geometry_msgs roscpp rospy std_msgs turtlesim message_runtime <span class="comment">#设置好的依赖放在这个位置</span></span><br><span class="line"><span class="comment">#  DEPENDS system_lib</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在编写文件后添加依赖，以发布为例,注意第三项</span></span><br><span class="line"><span class="keyword">add_executable</span>(person_publisher src/person_publisher.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(person_publisher <span class="variable">$&#123;catkin_LIBRARIES&#125;</span>)</span><br><span class="line"><span class="keyword">add_dependencies</span>(person_publisher <span class="variable">$&#123;PROJECT_NAME&#125;</span>_generate_messages_cpp)<span class="comment"># 与动态生成的头文件作连接</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>编译<code>catkin_make</code>生成语言相关文件：在<code>devel/include/learning_topic/Person.h</code>可以查看编译后的代码<ol>
<li>对于编译的时候，最好在CmakeLists.txt将要编译的cpp文件注释下，然后再编译，因为可能cpp有之前.h消息头文件，而删除devel，导致后面编译不过</li>
</ol>
</li>
<li>编写发布和订阅更上面内容类似</li>
<li>对于要使用这个类型消息的话，生成.h文件，然后直接将这个文件复制相应位置就行了<br>对于直接文件</li>
</ol>
<ul>
<li>如果rqt添加没有反映，就source一下</li>
</ul>
<p><strong>示例</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    需求: 循环发布人的信息</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;demo02_talker_listener/Person.h&quot;</span></span></span><br><span class="line"><span class="comment">//头文件说明</span></span><br><span class="line"><span class="comment">//#include &quot;demo02_talker_listener/Person.h&quot;说明是在demo02_talker_listener功能包的路径</span></span><br><span class="line"><span class="comment">//复制.h文件到相应位置</span></span><br><span class="line"><span class="comment">//#include &quot;include/Person.h&quot;说明是1.cpp与include同一级目录,.h文件在include下</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.初始化 ROS 节点</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;talker_person&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.创建 ROS 句柄</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.创建发布者对象</span></span><br><span class="line">    <span class="comment">//demo02_talker_listener是生成的命名空间，需要看生成的.h文件</span></span><br><span class="line">    ros::Publisher pub = nh.<span class="built_in">advertise</span>&lt;demo02_talker_listener::Person&gt;(<span class="string">&quot;chatter_person&quot;</span>,<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.组织被发布的消息，编写发布逻辑并发布消息；</span></span><br><span class="line">    demo02_talker_listener::Person p;</span><br><span class="line">    p.name = <span class="string">&quot;sunwukong&quot;</span>;</span><br><span class="line">    p.age = <span class="number">2000</span>;</span><br><span class="line">    p.height = <span class="number">1.45</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ros::Rate <span class="title">r</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        pub.<span class="built_in">publish</span>(p);</span><br><span class="line">        p.age += <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;我叫:%s,今年%d岁,高%.2f米&quot;</span>, p.name.<span class="built_in">c_str</span>(), p.age, p.height);</span><br><span class="line"></span><br><span class="line">        r.<span class="built_in">sleep</span>();</span><br><span class="line">        ros::<span class="built_in">spinOnce</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="客户端实现"><a href="#客户端实现" class="headerlink" title="客户端实现"></a>客户端实现</h1><p>流程</p>
<ul>
<li>初始化ROS节点</li>
<li>创建一个Client实例</li>
<li>发布服务请求数据</li>
<li>等待Server处理后的应答结果</li>
</ul>
<p> 创建功能包<br> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">catkin_create_pkg learning_service roscpp std_msgs geometry_msgs turtlesim</span><br></pre></td></tr></table></figure><br> 新建cpp<br> <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//该例程将请求/spawn服务，服务数据类型为turtlesim::Spawn</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;turtlesim/Spawn.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span> *argv)</span></span>&#123;</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;turtle_spawn&quot;</span>);</span><br><span class="line">    ros::NodeHandle node;<span class="comment">//创建节点语句</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//发现/spawn服务后，创建一个服务客户端，连接名/spawn的service</span></span><br><span class="line">    ros::service::<span class="built_in">waitForService</span>(<span class="string">&quot;/spawn&quot;</span>);</span><br><span class="line">    ros::ServiceClient add_turtle=node.<span class="built_in">serviceClient</span>&lt;turtlesim::Spawn&gt;(<span class="string">&quot;/spawn&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//初始化turtlesim::Spawn的请求数据</span></span><br><span class="line">    turtlesim::Spawn srv;</span><br><span class="line">    srv.request.x=<span class="number">2.4</span>;</span><br><span class="line">    srv.request.y=<span class="number">2.6</span>;</span><br><span class="line">    srv.request.name=<span class="string">&quot;turtle2&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//请求服务调用</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;call service to spwan turtle[x:%0.6f,y:%0.6f,name:%s]&quot;</span>,</span><br><span class="line">        srv.request.x,srv.request.y,srv.request.name);</span><br><span class="line">    add_turtle.<span class="built_in">call</span>(srv);<span class="comment">//类似publisher</span></span><br><span class="line">    <span class="comment">//显示服务调用结果</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Spawn turtle successfully [name:%s]&quot;</span>,srv.request.name.<span class="built_in">c_str</span>());</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>按上面流程添加cmake文件，编译</li>
</ul>
<h1 id="服务端实现"><a href="#服务端实现" class="headerlink" title="服务端实现"></a>服务端实现</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;geometry_msgs/Twist.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;std_srvs/Trigger.h&gt;</span></span></span><br><span class="line">ros::Publisher turtle_vel_pub;</span><br><span class="line"><span class="type">bool</span> pubCommand=<span class="literal">false</span>;</span><br><span class="line"><span class="comment">//service回调函数</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">commandCallback</span><span class="params">(std_srvs::Trigger::Request &amp;req,std_srvs::Trigger::Response &amp;res)</span></span>&#123;</span><br><span class="line">    pubCommand=!pubCommand;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;publish turtle velocity command [%s]&quot;</span>,pubCommand==<span class="literal">true</span>? <span class="string">&quot;Yes&quot;</span>:<span class="string">&quot;No&quot;</span>);</span><br><span class="line">    <span class="comment">//设置反馈数据</span></span><br><span class="line">    res.success=<span class="literal">true</span>;</span><br><span class="line">    res.message=<span class="string">&quot;Change turtle command state&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span> *argv[])</span></span>&#123;</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;turtle_command_server&quot;</span>);</span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line">    <span class="comment">//创建一个/turtle_command的server,注册回调函数commanderCallback</span></span><br><span class="line">    ros::ServiceServer command_service=n.<span class="built_in">advertiseService</span>(<span class="string">&quot;/turtle_command&quot;</span>,commandCallback);</span><br><span class="line">    <span class="comment">//创建一个Publisher,发布一个名为/turtle1/cmd_vel的topic,消息类型为geometry_msgs::Twist,队列长度为10</span></span><br><span class="line">    turtle_vel_pub=n.<span class="built_in">advertise</span>&lt;geometry_msgs::Twist&gt;(<span class="string">&quot;/turtle1/cmd_vel&quot;</span>,<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Ready to receive&quot;</span>);</span><br><span class="line">    <span class="function">ros::Rate <span class="title">loop_rate</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line">    <span class="keyword">while</span>(ros::<span class="built_in">ok</span>())&#123;</span><br><span class="line">        ros::<span class="built_in">spinOnce</span>();<span class="comment">//查看一次回调函数队列</span></span><br><span class="line">        <span class="comment">//如果标志为true,则发布速度指令</span></span><br><span class="line">        <span class="keyword">if</span>(pubCommand)&#123;</span><br><span class="line">            geometry_msgs::Twist vel_msg;</span><br><span class="line">            vel_msg.linear.x=<span class="number">0.2</span>;</span><br><span class="line">            vel_msg.angular.z=<span class="number">0.2</span>;</span><br><span class="line">            turtle_vel_pub.<span class="built_in">publish</span>(vel_msg);</span><br><span class="line">        &#125;</span><br><span class="line">        loop_rate.<span class="built_in">sleep</span>();<span class="comment">//按照循环频率延时</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>开启服务后：用<code>rosservice call /turtle_command</code>可以来控制海龟运动</p>
<h2 id="服务数据的定义与使用"><a href="#服务数据的定义与使用" class="headerlink" title="服务数据的定义与使用"></a>服务数据的定义与使用</h2><p>定义自定义服务数据</p>
<ol>
<li>首先在功能包文件夹下创建srv文件夹，接着创建Person.srv<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> name</span><br><span class="line">uint8 age</span><br><span class="line">uint8 sex</span><br><span class="line"></span><br><span class="line">uint8 unknown=<span class="number">0</span></span><br><span class="line">uint8 male=<span class="number">1</span></span><br><span class="line">uint8 female=<span class="number">2</span></span><br><span class="line">---</span><br><span class="line"><span class="built_in">string</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment">//横线上方是request请求，横线下方是回应response</span></span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>下面的操作与[[ROS#话题消息的定义与使用]]类似<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_service_files(FILES Person.srv)<span class="comment">#与上面操作不同的地方注意，文件名和函数名不同</span></span><br></pre></td></tr></table></figure></li>
<li>接着编译生成相关文件</li>
</ul>
<h2 id="参数使用与编程方法"><a href="#参数使用与编程方法" class="headerlink" title="参数使用与编程方法"></a>参数使用与编程方法</h2><ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/LacyExsale/article/details/117092499?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169268961516800225541999%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=169268961516800225541999&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-117092499-null-null.142%5Ev93%5EchatsearchT3_2&utm_term=ros%E5%8F%82%E6%95%B0&spm=1018.2226.3001.4187">使用方法</a></li>
</ul>
<ol>
<li>先创建一个功能包<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">catkin_create_pkg learning_parameter roscpp rospy std_srvs</span><br></pre></td></tr></table></figure>
参数命令行使用<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rosparam <span class="built_in">list</span>  <span class="comment">//列出当前多有参数</span></span><br><span class="line">rosparam get param_key  <span class="comment">//显示某个参数值</span></span><br><span class="line">rosparam <span class="built_in">set</span> param_key param_value  <span class="comment">//设置某个参数值</span></span><br><span class="line">rosparam dump file_name <span class="comment">//保存参数到文件</span></span><br><span class="line">rosparam load file_name  <span class="comment">//从文件加载参数（文件修改后）</span></span><br><span class="line">rosparam delet param_key  <span class="comment">//删除参数</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h2><ul>
<li>ros::Subscriber：用于订阅话题消息。通过创建 ros::Subscriber 对象，你可以接收其他节点发布的话题消息，并在回调函数中处理这些消息。</li>
<li>ros::Publisher：用于发布话题消息。通过创建 ros::Publisher 对象，你可以向话题发布消息，供其他节点订阅和接收。<br>![[Pasted image 20230907161013.png]]</li>
<li>ros::ServiceClient：<strong>用于调用服务</strong>。通过创建 ros::ServiceClient 对象，你可以向其他节点发送服务请求，<strong>并等待并接收服务响应</strong>。</li>
</ul>
<p>这三个类的区别在于它们的用途和通信方式</p>
<ul>
<li>ros::Subscriber 和 ros::Publisher 用于发布&#x2F;订阅模式的通信。在发布&#x2F;订阅模式中，消息的发布者（发布者）将消息发布到一个特定的话题，而订阅者（消费者）订阅了这个话题并接收消息。发布者和订阅者之间<strong>通过话题进行异步通信</strong>，发布者和订阅者之间<strong>没有直接的请求-响应关系</strong>。</li>
<li>ros::ServiceClient <strong>用于请求-响应模式的通信</strong>。在请求-响应模式中，服务的客户端向服务的服务器发送请求，并等待服务器完成处理并返回响应。客户端和服务器之间通过服务进行同步通信，客户端发送请求并等待响应。<br>![[Pasted image 20230907155557.png]]</li>
<li>因此，<strong>ros::Subscriber 和 ros::Publisher 适用于一对多的消息通信，而 ros::ServiceClient 适用于一对一的请求-响应通信</strong>。</li>
<li>ros::Publisher和ros::ServiceClient 可理解成一个类型</li>
<li>ros::Subscriber 和ros::ServiceServer理解成一个类型<br>![[Pasted image 20230907160056.png]]</li>
</ul>
<h1 id="坐标系管理系统"><a href="#坐标系管理系统" class="headerlink" title="坐标系管理系统"></a>坐标系管理系统</h1><ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_53475254/article/details/118658041?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169269014116800184112173%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=169269014116800184112173&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-118658041-null-null.142%5Ev93%5EchatsearchT3_2&utm_term=ros%E4%B8%AD%E7%9A%84%E5%9D%90%E6%A0%87%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F&spm=1018.2226.3001.4187">坐标系管理系统</a><br><strong>TF功能包的作用</strong>是一种树状数据结构，根据时间缓冲并维护多个参考系之间的坐标变换关系，可以帮助程序员在任意时间，将点、向量等数据的坐标，在两个参考系中完成坐标变换,默认记录10S内的坐标。</li>
</ul>
<p><strong>TF坐标变换的实现方式</strong></p>
<ul>
<li>广播TF变换</li>
<li>监听TF变换</li>
</ul>
<ol>
<li>创建功能包：<code>catkin_create_pkg learning_tf roscpp rospy tf turtlesim</code><br>广播器编写turtle_tf_broadcaster.cpp<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程产生tf数据，并计算、发布turtle2的速度指令</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tf/transform_broadcaster.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;turtlesim/Pose.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::string turtle_name;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">poseCallback</span><span class="params">(<span class="type">const</span> turtlesim::PoseConstPtr&amp; msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 创建tf的广播器</span></span><br><span class="line">	<span class="type">static</span> tf::TransformBroadcaster br;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 初始化tf数据</span></span><br><span class="line">	tf::Transform transform;</span><br><span class="line">	transform.<span class="built_in">setOrigin</span>( tf::<span class="built_in">Vector3</span>(msg-&gt;x, msg-&gt;y, <span class="number">0.0</span>) );</span><br><span class="line">	tf::Quaternion q;</span><br><span class="line">	q.<span class="built_in">setRPY</span>(<span class="number">0</span>, <span class="number">0</span>, msg-&gt;theta);</span><br><span class="line">	transform.<span class="built_in">setRotation</span>(q);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 广播world与海龟坐标系之间的tf数据</span></span><br><span class="line">	br.<span class="built_in">sendTransform</span>(tf::<span class="built_in">StampedTransform</span>(transform, ros::Time::<span class="built_in">now</span>(), <span class="string">&quot;world&quot;</span>, turtle_name));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 初始化ROS节点</span></span><br><span class="line">	ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;my_tf_broadcaster&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 输入参数作为海龟的名字</span></span><br><span class="line">	<span class="keyword">if</span> (argc != <span class="number">2</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">ROS_ERROR</span>(<span class="string">&quot;need turtle name as argument&quot;</span>); </span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	turtle_name = argv[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 订阅海龟的位姿话题</span></span><br><span class="line">	ros::NodeHandle node;</span><br><span class="line">	ros::Subscriber sub = node.<span class="built_in">subscribe</span>(turtle_name+<span class="string">&quot;/pose&quot;</span>, <span class="number">10</span>, &amp;poseCallback);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环等待回调函数</span></span><br><span class="line">	ros::<span class="built_in">spin</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
监听器编写turtle_tf_listener.cpp<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程监听tf数据，并计算、发布turtle2的速度指令</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tf/transform_listener.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;geometry_msgs/Twist.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;turtlesim/Spawn.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 初始化ROS节点</span></span><br><span class="line">	ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;my_tf_listener&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">	ros::NodeHandle node;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 请求产生turtle2</span></span><br><span class="line">	ros::service::<span class="built_in">waitForService</span>(<span class="string">&quot;/spawn&quot;</span>);</span><br><span class="line">	ros::ServiceClient add_turtle = node.<span class="built_in">serviceClient</span>&lt;turtlesim::Spawn&gt;(<span class="string">&quot;/spawn&quot;</span>);</span><br><span class="line">	turtlesim::Spawn srv;</span><br><span class="line">	add_turtle.<span class="built_in">call</span>(srv);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建发布turtle2速度控制指令的发布者</span></span><br><span class="line">	ros::Publisher turtle_vel = node.<span class="built_in">advertise</span>&lt;geometry_msgs::Twist&gt;(<span class="string">&quot;/turtle2/cmd_vel&quot;</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建tf的监听器</span></span><br><span class="line">	tf::TransformListener listener;</span><br><span class="line"></span><br><span class="line">	<span class="function">ros::Rate <span class="title">rate</span><span class="params">(<span class="number">10.0</span>)</span></span>;</span><br><span class="line">	<span class="keyword">while</span> (node.<span class="built_in">ok</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 获取turtle1与turtle2坐标系之间的tf数据</span></span><br><span class="line">		tf::StampedTransform transform;</span><br><span class="line">		<span class="keyword">try</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//查询是否有这两个坐标系，查询当前时间，如果超过3s则报错</span></span><br><span class="line">			listener.<span class="built_in">waitForTransform</span>(<span class="string">&quot;/turtle2&quot;</span>, <span class="string">&quot;/turtle1&quot;</span>, ros::<span class="built_in">Time</span>(<span class="number">0</span>), ros::<span class="built_in">Duration</span>(<span class="number">3.0</span>));</span><br><span class="line"></span><br><span class="line">			listener.<span class="built_in">lookupTransform</span>(<span class="string">&quot;/turtle2&quot;</span>, <span class="string">&quot;/turtle1&quot;</span>, ros::<span class="built_in">Time</span>(<span class="number">0</span>), transform);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">catch</span> (tf::TransformException &amp;ex) </span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">ROS_ERROR</span>(<span class="string">&quot;%s&quot;</span>,ex.<span class="built_in">what</span>());</span><br><span class="line">			ros::<span class="built_in">Duration</span>(<span class="number">1.0</span>).<span class="built_in">sleep</span>();</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 根据turtle1与turtle2坐标系之间的位置关系，发布turtle2的速度控制指令</span></span><br><span class="line">		geometry_msgs::Twist vel_msg;</span><br><span class="line">		vel_msg.angular.z = <span class="number">4.0</span> * <span class="built_in">atan2</span>(transform.<span class="built_in">getOrigin</span>().<span class="built_in">y</span>(),</span><br><span class="line">				                        transform.<span class="built_in">getOrigin</span>().<span class="built_in">x</span>());</span><br><span class="line">		vel_msg.linear.x = <span class="number">0.5</span> * <span class="built_in">sqrt</span>(<span class="built_in">pow</span>(transform.<span class="built_in">getOrigin</span>().<span class="built_in">x</span>(), <span class="number">2</span>) +</span><br><span class="line">				                      <span class="built_in">pow</span>(transform.<span class="built_in">getOrigin</span>().<span class="built_in">y</span>(), <span class="number">2</span>));</span><br><span class="line">		turtle_vel.<span class="built_in">publish</span>(vel_msg);</span><br><span class="line"></span><br><span class="line">		rate.<span class="built_in">sleep</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>接着编写[[ROS#cmake文件|cmake文件]]文件并编译</li>
<li>运行<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">roscore</span><br><span class="line">rosrun turtlesim turtlesim_node</span><br><span class="line">rosrun learning_tf turtle_tf_broadcaster __name:=turtle1_tf_broadcaster /turtle1   <span class="comment">//name后面的turtle1替代my_tf_broadcaster</span></span><br><span class="line">rosrun learning_tf turtle_tf_broadcaster __name:=turtle2_tf_broadcaster /turtle2</span><br><span class="line">rosrun learning_tf turtle_tf_listener</span><br><span class="line">rosrun turtlesim turtle_teleop_key</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="launch启动文件"><a href="#launch启动文件" class="headerlink" title="launch启动文件"></a>launch启动文件</h1><ul>
<li>rosrun是启动单个节点,roslaunch可以同时启动多个节点</li>
<li><a target="_blank" rel="noopener" href="https://wiki.ros.org/roslaunch/XML">官方说明</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45590473/article/details/122647788">详解1</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/zcw_jszs/article/details/131876383?spm=1001.2101.3001.6650.2&utm_medium=distribute.pc_relevant.none-task-blog-2~default~YuanLiJiHua~Position-2-131876383-blog-123661717.235%5Ev38%5Epc_relevant_anti_t3&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~YuanLiJiHua~Position-2-131876383-blog-123661717.235%5Ev38%5Epc_relevant_anti_t3&utm_relevant_index=5">语法说明</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/CH_monsy/article/details/107664893">详解2</a></li>
</ul>
<h2 id="launch元素"><a href="#launch元素" class="headerlink" title="launch元素"></a>launch元素</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Launch file content goes here --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>&lt;launch&gt;</code>元素是roslaunch文件的根元素，表示一个启动配置的开始。所有其他元素都必须包含在<code>&lt;launch&gt;</code>元素的内部。一个roslaunch文件只能包含一个<code>&lt;launch&gt;</code>元素。</li>
</ul>
<h2 id="node元素"><a href="#node元素" class="headerlink" title="node元素"></a>node元素</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;package_name&quot;</span> <span class="attr">type</span>=<span class="string">&quot;node_type&quot;</span> <span class="attr">name</span>=<span class="string">&quot;node_name&quot;</span> <span class="attr">args</span>=<span class="string">&quot;arguments&quot;</span> <span class="attr">output</span>=<span class="string">&quot;output_option&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>&lt;node&gt;</code>元素用于定义一个要启动的ROS节点。它包含以下属性：</p>
<ul>
<li><strong>pkg:</strong> 节点所在的包名。</li>
<li><strong>type</strong>: 节点的类型，即<strong>节点可执行文件</strong>的名称。</li>
<li><strong>name</strong>: 节点重映射的名称，相当于在系统中给节点所在源文件改了个名字；</li>
<li><strong>args</strong>: 可选属性，用于传递给节点的命令行参数。（对于spawn_model执行文件来说还有很多属性）<ul>
<li>-s：通常用于指定一个设置（setting），比如传递一个配置文件路径或者其他设置文件的参数。</li>
<li>-file：用于指定一个文件，可能是一个数据文件或者配置文件的路径。</li>
<li>-model：用于指定模型名</li>
<li>-param：用于指定一个ROS参数，这个参数将会传递给节点作为参数之一。</li>
</ul>
</li>
<li><strong>output</strong>: 可选属性，用于定义节点的输出选项，可以是”screen”（输出到屏幕），”log”（输出到日志文件），或”none”（无输出）。<br>其他重要的</li>
<li>respawn： 如果节点意外关闭是否重新启动。</li>
<li>Respawn_delay&#x3D;”delay_time”：表示节点延迟启动delay_time秒。</li>
<li>required&#x3D;true|false一般用在非常重要的节点（一旦这个节点停止运行则整个系统都会受影响）上。一旦这个节点进程结束（这个节点被杀死了），整个系统的所有节点都会停止运行</li>
<li>ns： &#x3D;namespace可以为每个待启动节点自定义一个<strong>命名空间</strong>，来避免使用时命名冲突的问题。</li>
<li>args： 可在启动节点时为每个节点添加参数，如在新建Ros工作空间时可以添加roscpp、rospy、tf等参数表示新建工作空间的依赖项。</li>
<li>machine： 可以设置运行该节点的PC的名称、address、ros-root和ros-package-path。</li>
<li>remap： 可以<strong>更改节点名称</strong>、话题名称等等，在节点中用到的ROS变量的名称。例如：。</li>
<li>include： 可以加载属于同一个功能包或不同的功能包的另一个launch,并将其作为一个launch文件来运行。</li>
<li>group： 用于分组正在运行的节点。</li>
<li>test： 用于测试节点。类似于，但是有可以用于测试的选项。</li>
</ul>
<h2 id="param元素"><a href="#param元素" class="headerlink" title="param元素"></a>param元素</h2><param name="parameter_name" value="parameter_value" />
<param name="parameter_name" value="parameter_value" />
<param name="parameter_name" value="parameter_value" />
<param name="parameter_name" value="parameter_value" />
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;parameter_name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;parameter_value&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
用于在参数服务器中设置参数。它包含以下属性：
- name: 参数的名称
- value: 参数的值
- 参数服务器是ROS中用于存储参数的一个全局数据库，节点可以在运行时从参数服务器获取参数的值。使用`<param>`元素可以在**节点启动前设定节点需要使用的参数**。
## arg元素
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;argument_name&quot;</span> <span class="attr">default</span>=<span class="string">&quot;default_value&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
`<arg>`元素用于定义参数化的参数，可以在启动时传入不同的参数值。它包含以下属性：
- name: 参数的名称。
- default: 参数的默认值，可选属性。如果没有在启动命令中传入该参数，则会使用默认值。
- 使用<`arg>`元素可以使启动配置更具灵活性，可以根据不同的场景传入不同的参数值。
### 参数设置语法
**上面的方式算一种**
**< rosparam >**
`<rosparam file="$(find var_strc_uav)/config/params.yaml" command="load" ns=“params"/>`
- 从参数文件params.yaml中加载所有参数，上传到Ros的参数服务器中，定义命名空间为params，其中：
- file：参数文件名称
- command：当前操作
- ns：命名空间名称

<p><strong>&lt; arg &gt;标签</strong><br>实现功能：<br>arg标签中的参数仅限于在launch文件之间进行参数传递，该语句表示在当前launch文件下定义一个名为“arg-name”的参数，其默认参数值为“arg-value”，其中：<br><code>&lt;arg name=&quot;arg-name&quot; default=&quot;arg-value&quot; /&gt;</code></p>
<ul>
<li>name：在当前launch文件中定义一个参数的参数名称</li>
<li>default：该参数的默认参数值<param name="foo" value="$(arg arg-name)" /></li>
</ul>
<p><strong>&lt; arg &gt;定义参数调用方法1</strong><br>实现功能：</p>
<ul>
<li>launc文件中找到名为arg-name的参数，取出参数值，将参数值赋值给名为foo的参数，其中：<br><code>&lt;param name=&quot;foo&quot; value=&quot;$(arg arg-name)&quot; /&gt;</code></li>
<li>name：取出参数值后赋值给参数的参数名</li>
<li>value&#x3D;”$(arg xxx)”：在launch文件内部找到名为 “xxx”的参数，取出参数值，注意不能漏掉 $和前面的arg前缀</li>
</ul>
<p><strong>&lt; arg &gt;定义参数调用方法2</strong><br><code>&lt;node name=&quot;node&quot; pkg=&quot;package&quot; type=&quot;type &quot; args=&quot;$(arg arg-name)&quot; /&gt;</code></p>
<ul>
<li>实现功能：在启动节点时，取出launch文件中的arg-name参数作为节点的输入参数参与节点运行。</li>
</ul>
<h3 id="例子讲解"><a href="#例子讲解" class="headerlink" title="例子讲解"></a>例子讲解</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;gui&quot;</span> <span class="attr">default</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;debug&quot;</span> <span class="attr">default</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;verbose&quot;</span> <span class="attr">default</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;paused&quot;</span> <span class="attr">default</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- 使用&lt;include&gt;标签来引用另一个launch文件，即gazebo_ros软件包中的empty_world.launch文件。这个launch文件会启动Gazebo仿真，并加载一个空白的世界模型。在引用时，通过&lt;arg&gt;标签将参数传递给被引用的launch文件，也就是上面的参数，如果没有的话，就会按照之前的原定参数去实现，继承了empty_world.launch的大部分必要功能，其他参数只需设置为其默认值--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find gazebo_ros)/launch/empty_world.launch&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;gui&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg gui)&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;world_name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg world)&quot;</span>/&gt;</span><span class="comment">&lt;!-- 这里的world_name是empty_world.launch定义的，传入参数是这个文件定义的 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;debug&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg debug)&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;verbose&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg verbose)&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;paused&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg paused)&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="group元素"><a href="#group元素" class="headerlink" title="group元素"></a>group元素</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">group</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Grouped nodes and other elements go here --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>&lt;group&gt;</code>元素用于将多个节点组织在一个组内，方便统一管理。</li>
<li>包含多个<code>&lt;node&gt;、&lt;param&gt;、&lt;arg&gt;</code>等其他元素。</li>
<li>使用<code>&lt;group&gt;</code>元素可以使启动配置更加结构化，将相关的节点组织在一起，提高配置的可读性和维护性。</li>
</ul>
<h2 id="include元素"><a href="#include元素" class="headerlink" title="include元素"></a>include元素</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;path_to_launch_file&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>&lt;include&gt;</code>元素允许将其他roslaunch文件包含在当前文件中，实现模块化配置。它包含一个file属性，用于指定要包含的roslaunch文件的路径。</li>
<li>通过使用<code>&lt;include&gt;</code>元素，将大型的启动配置拆分为多个小文件，使配置更加清晰和易于管理。</li>
<li>通过灵活地组合这些元素，构建出复杂的启动配置，</li>
</ul>
<h2 id="roslaunch中的高级配置选项"><a href="#roslaunch中的高级配置选项" class="headerlink" title="roslaunch中的高级配置选项"></a>roslaunch中的高级配置选项</h2><h3 id="使用remap标签进行话题重映射"><a href="#使用remap标签进行话题重映射" class="headerlink" title="使用remap标签进行话题重映射"></a>使用remap标签进行话题重映射</h3><p>在roslaunch中，<code>&lt;remap&gt;</code>标签允许您在启动文件中对话题进行<strong>重映射</strong>，从而解决节点之间的通信问题。通常在启动文件中，节点的话题名称已经预先定义，但在某些情况下，可能希望在启动时动态地更改节点之间的通信话题。这就是<code>&lt;remap&gt;</code>标签的作用。<strong>也就是重命名</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Node with original topic --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;package_name&quot;</span> <span class="attr">type</span>=<span class="string">&quot;node_type&quot;</span> <span class="attr">name</span>=<span class="string">&quot;node1&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- Node with remapped topic --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;package_name&quot;</span> <span class="attr">type</span>=<span class="string">&quot;node_type&quot;</span> <span class="attr">name</span>=<span class="string">&quot;node2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">remap</span> <span class="attr">from</span>=<span class="string">&quot;original_topic&quot;</span> <span class="attr">to</span>=<span class="string">&quot;remapped_topic&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>在上面的例子中，启动了两个节点node1和node2，它们来自同一个包package_name并具有相同的类型node_type。通过<code>&lt;remap&gt;</code>标签，将node2中的话题original_topic重映射为remapped_topic。这样，在node2内部，它会接收来自original_topic的数据，但实际上与node1通信的话题是remapped_topic。</p>
</blockquote>
<p>使用&lt;<code>remap&gt;</code>标签可以方便地解决节点之间话题名称的冲突问题，从而实现灵活的通信。<br><strong>例子</strong></p>
<ul>
<li>作用：将Ros中某些计算图的资源进行重新命名，如：<br><code>&lt;remap from=&quot;/turtlebot/cmd_vel&quot; to=&quot;/cmd_vel&quot;/&gt;</code><br><strong>实现功能</strong><br>将Ros中的Topic：”&#x2F;turtlebot&#x2F;cmd_vel”进行映射，重命名为”&#x2F;cmd_vel”，其中：</li>
<li>from：原命名</li>
<li>to：映射之后的命名</li>
</ul>
<h3 id="引入参数并使用arg标签"><a href="#引入参数并使用arg标签" class="headerlink" title="引入参数并使用arg标签"></a>引入参数并使用arg标签</h3><p>在实际项目中，可能需要根据不同的运行环境或需求来调整节点的参数。为了使启动配置更加灵活，可以使用<code>&lt;arg&gt;</code>标签定义参数，并在roslaunch文件中引入和使用这些参数。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Define an argument with default value --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;my_param&quot;</span> <span class="attr">default</span>=<span class="string">&quot;default_value&quot;</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- Start the node with the specified parameter value --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;package_name&quot;</span> <span class="attr">type</span>=<span class="string">&quot;node_type&quot;</span> <span class="attr">name</span>=<span class="string">&quot;my_node&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;param_name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg my_param)&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>使用<code>&lt;arg&gt;</code>标签定义了一个参数my_param，并给它设置了默认值default_value。在启动节点my_node时，使用<code>&lt;param&gt;</code>标签将参数param_name设置为(arg my_param)，这里的(arg my_param)表示使用之前定义的参数my_param的值。</li>
<li>使用&lt;<code>arg&gt;</code>标签，我们可以在启动时动态地传入参数值，从而灵活地配置节点。</li>
</ul>
<h3 id="条件启动节点：使用if和unless语句"><a href="#条件启动节点：使用if和unless语句" class="headerlink" title="条件启动节点：使用if和unless语句"></a>条件启动节点：使用if和unless语句</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Start node1 only if the condition is true --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">condition</span> <span class="attr">value</span>=<span class="string">&quot;$(arg condition_variable)&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;package_name&quot;</span> <span class="attr">type</span>=<span class="string">&quot;node_type&quot;</span> <span class="attr">name</span>=<span class="string">&quot;node1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- Start node2 only if the condition is false --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">unless</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">condition</span> <span class="attr">value</span>=<span class="string">&quot;$(arg condition_variable)&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;package_name&quot;</span> <span class="attr">type</span>=<span class="string">&quot;node_type&quot;</span> <span class="attr">name</span>=<span class="string">&quot;node2&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">unless</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>在上面的例子中，使用<code>&lt;if&gt;</code>和<code>&lt;unless&gt;</code>标签分别对node1和node2进行条件判断。<code>&lt;condition&gt;</code>标签用于定义条件判断的值，它的值来自之前定义的参数condition_variable。如果condition_variable的值为true，则node1会被启动；如果为false，则node2会被启动。</p>
</blockquote>
<ul>
<li>使用条件语句，可以根据不同的情况来启动不同的节点，使得启动配置更加灵活和智能。</li>
<li>为了更具体地说明roslaunch文件的高级配置选项和调试策略，假设有一个简单的ROS项目，其中包含两个节点，一个发布者节点（publisher_node）和一个订阅者节点（subscriber_node）。发布者节点发布一个名为&#x2F;chatter的话题，订阅者节点接收并显示收到的消息。</li>
<li>我们将创建一个roslaunch文件来启动这两个节点，并演示如何使用<code>&lt;remap&gt;</code>标签进行话题重映射，引入参数，以及使用调试选项和调试策略。<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Define an argument for message rate --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;message_rate&quot;</span> <span class="attr">default</span>=<span class="string">&quot;1.0&quot;</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- Start the publisher_node with a remapped topic and custom message rate --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;my_package&quot;</span> <span class="attr">type</span>=<span class="string">&quot;publisher_node&quot;</span> <span class="attr">name</span>=<span class="string">&quot;publisher&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">remap</span> <span class="attr">from</span>=<span class="string">&quot;chatter&quot;</span> <span class="attr">to</span>=<span class="string">&quot;custom_chatter_topic&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;message_rate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg message_rate)&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- Start the subscriber_node --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;my_package&quot;</span> <span class="attr">type</span>=<span class="string">&quot;subscriber_node&quot;</span> <span class="attr">name</span>=<span class="string">&quot;subscriber&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>
说明：</li>
<li>我们在roslaunch文件中使用<code>&lt;arg&gt;</code>标签定义了一个参数message_rate，并设置了默认值为1.0。这个参数用于控制消息发布的频率。</li>
<li>在publisher_node节点中，我们使用<code>&lt;remap&gt;</code>标签将发布的话题<code>/chatter</code>重映射为<code>/custom_chatter_topic</code>。这样，在其他节点中订阅的话题名就是<code>/custom_chatter_topic</code>。</li>
<li>同时，使用<code>&lt;param&gt;</code>标签将参数message_rate设置为我们之前定义的message_rate参数的值，这样我们可以在启动时传入不同的频率。</li>
</ul>
<p><strong>参数设置</strong><br>![[Pasted image 20230822191024.png]]</p>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><ol>
<li>首先创建功能包：<code>catkin_create_pkg learning_launch</code>,接着在功能包创建launch文件夹</li>
<li>在launch文件夹中新建simple.launch并写入<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;learning_topic&quot;</span> <span class="attr">type</span>=<span class="string">&quot;person_subscriber&quot;</span> <span class="attr">name</span>=<span class="string">&quot;talker&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;learning_topic&quot;</span> <span class="attr">type</span>=<span class="string">&quot;person_publisher&quot;</span> <span class="attr">name</span>=<span class="string">&quot;listener&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> /&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>使用命令编译</li>
<li>启动文件<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch learning_launch simple.launch</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>对于世界文件</strong></p>
<ul>
<li>对于px4的世界文件在<code>Tools/sitl_gazebo/worlds/</code>中</li>
<li>接着在launch文件中添加文件路径即可<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;world&quot;</span> <span class="attr">default</span>=<span class="string">&quot;$(find mavlink_sitl_gazebo)/worlds/ego_simple.world&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 这句先找到mavlink_sitl_gazebo功能包，然后在他的路径下找到ego_simple.world --&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="sh脚本文件启动"><a href="#sh脚本文件启动" class="headerlink" title=".sh脚本文件启动"></a>.sh脚本文件启动</h1><p>这是在bash终端和terminate中实现</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash  #注释用#， 使用Bash解释器</span><br><span class="line"># 修改/dev/ttyACM0文件的权限为<span class="number">777</span>，即可读、可写、可执行权限。</span><br><span class="line">sudo chmod <span class="number">777</span> /dev/ttyACM0</span><br><span class="line">sudo chmod <span class="number">777</span> /dev/ttyUSB0</span><br><span class="line">sudo chmod <span class="number">777</span> /dev/ttyUSB1</span><br><span class="line"></span><br><span class="line">source ~/.bashrc</span><br><span class="line"># 在当前Shell中执行.bashrc文件，即加载.bashrc文件中定义的环境变量和别名配置。</span><br><span class="line"></span><br><span class="line"># 打开新的终端窗口，并在其中执行roscore命令，然后进入交互式Shell。</span><br><span class="line">gnome-terminal --window -e <span class="string">&#x27;bash -c &quot;roscore; exec bash&quot;&#x27;</span> \</span><br><span class="line"></span><br><span class="line"># 打开新的终端窗口，并在其中等待<span class="number">3</span>秒后执行roslaunch mavros px4.launch命令，然后进入交互式Shell。</span><br><span class="line">gnome-terminal --window -e <span class="string">&#x27;bash -c &quot;sleep 3; roslaunch mavros px4.launch; exec bash&quot;&#x27;</span> \</span><br><span class="line"></span><br><span class="line"># 在前一个终端窗口中新建一个选项卡，在该选项卡中等待<span class="number">3</span>秒后执行cd nooploop_ws &amp;&amp; source ./devel/setup.bash &amp;&amp;roslaunch serial serial.launch命令，然后进入交互式Shell</span><br><span class="line">--tab -e <span class="string">&#x27;bash -c &quot;sleep 3; cd nooploop_ws &amp;&amp; source ./devel/setup.bash &amp;&amp;roslaunch serial serial.launch; exec bash&quot;&#x27;</span> \</span><br><span class="line">--tab -e <span class="string">&#x27;bash -c &quot;sleep 5; source ~/CODE/PROJECT/plane_ws/devel/setup.bash &amp;&amp; roslaunch px4_realsense_bridge bridge.launch; exec bash&quot;&#x27;</span> \</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gnome-terminal --window -e <span class="string">&#x27;bash -c &quot;sleep 5; rostopic echo /mavros/local_position/pose; exec bash&quot;&#x27;</span> \</span><br><span class="line"></span><br><span class="line"># 每个命令的执行顺序是按照脚本中的顺序依次执行的</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="语法说明"><a href="#语法说明" class="headerlink" title="语法说明"></a>语法说明</h2><ul>
<li>注释：用于给脚本添加注解，提高可读性。注释以<code>#开头</code>，可以是单行注释或多行注释。</li>
<li>变量：使用变量来存储和操作数据。变量名通常以字母或下划线开头，不能以数字开头。变量赋值使用等号(&#x3D;)进行，注意等号两边不能有空格。</li>
<li>命令执行：可以在.sh文件中执行各种命令，包括系统命令、自定义命令和其他脚本文件。</li>
<li>控制结构：可以使用条件判断和循环结构来控制脚本的执行流程。常见的控制结构有if-else、for、while等。</li>
<li>函数：可以定义和调用函数，将一系列指令封装成可重复使用的代码块。</li>
<li>输入输出：可以使用echo命令输出内容到终端，使用read命令接收用户输入。</li>
<li><strong>运行.sh文件</strong>：在终端中通过.&#x2F;filename.sh命令来运行.sh文件，**需要给.sh文件添加可执行权限(chmod +x filename.sh)**。</li>
</ul>
<h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><p><strong>1.新建.sh文件</strong></p>
<ul>
<li>这里新建的.sh文件名为：test.sh</li>
</ul>
<p><strong>2.输入内容</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># !/bin/zsh</span><br><span class="line">cd /test2</span><br><span class="line">ls</span><br></pre></td></tr></table></figure>
<p><strong>3.赋予.sh文件执行权限</strong></p>
<ul>
<li>赋予.sh文件可执行权限，可以使用 <code>chmod 777 test.sh</code></li>
<li>这里是在bash文件中使用，但是我的是zsh终端，然后执行zsh test.sh即可<br><strong>4.运行</strong></li>
<li><code>./test.sh</code></li>
</ul>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><ul>
<li>这是在zsh终端和terminator使用</li>
<li>新建terminator终端才能用<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># !/bin/zsh</span><br><span class="line"># 水平分割要在terminator终端执行才行，不要默认端口</span><br><span class="line"># 模拟按下Ctrl+Shift+E键盘快捷键</span><br><span class="line">xdotool key Ctrl+Shift+e</span><br><span class="line">ls</span><br><span class="line"></span><br><span class="line"># 等待一段时间以确保水平分割完成</span><br><span class="line">sleep <span class="number">1</span></span><br><span class="line"># 模拟按下Alt+Tab键盘快捷键以切换到新创建的终端窗格</span><br><span class="line">xdotool key Alt+Tab</span><br><span class="line">roslaunch px4 indoor_test1.launch</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#但是这个水平分割后不能在新的终端用，还是在原始终端执行命令，待解决</span><br><span class="line"># # 垂直分割</span><br><span class="line"><span class="meta"># xdotool key Ctrl+Shift+v</span></span><br></pre></td></tr></table></figure>
实例2</li>
<li>这个用的zsh主题，用terminate和terminator终端都可以<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># !/bin/zsh</span><br><span class="line"># 对于直接用下个命令会卡住，所以要新建终端使用</span><br><span class="line"><span class="meta"># roslaunch px4 indoor1_test.launch</span></span><br><span class="line">gnome-terminal --window -e <span class="string">&#x27;zsh -c &quot;roslaunch px4 indoor1_test.launch; exec zsh&quot;&#x27;</span> \</span><br><span class="line">sleep <span class="number">2</span></span><br><span class="line"></span><br><span class="line"># # 打开新的终端窗口，并在其中执行ls命令，然后进入交互式Shell。</span><br><span class="line">gnome-terminal --window -e <span class="string">&#x27;zsh -c &quot;ls; exec zsh&quot;&#x27;</span> \</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="ROS-INFO"><a href="#ROS-INFO" class="headerlink" title="ROS_INFO"></a>ROS_INFO</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ROS_INFO_STREAM</span>(“Hello ROS”),输出字符串</span><br><span class="line"><span class="built_in">ROS_INFO</span>(“%s”, msg.data.<span class="built_in">c_str</span>()),输出一个字符串变量,在变量名后面。<span class="built_in">c_str</span>()</span><br><span class="line"><span class="built_in">ROS_INFO</span>(“I heard: [%s]”, msg.data.<span class="built_in">c_str</span>()),输出一个字符串变量，这里的中括号不是必须的，输出时会直接显示这个中括号</span><br><span class="line"><span class="built_in">ROS_INFO</span>(“I heard: [%s]”, msg-&gt;data.<span class="built_in">c_str</span>()),输出一个指针变量</span><br><span class="line"><span class="built_in">ROS_INFO</span>(“Publish Person Info: name:%s age:%d sex:%d”,</span><br><span class="line">person_msg.name.<span class="built_in">c_str</span>(), person_msg.age, person_msg.sex)，按数据类型输出</span><br><span class="line"></span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://github.com/wjl-a/data.github.io">醉卿枫</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://github.com/wjl-a/data.github.io/post/15fa7048.html">https://github.com/wjl-a/data.github.io/post/15fa7048.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://github.com/wjl-a/data.github.io" target="_blank">醉卿枫の博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/data.github.io/tags/ROS/">ROS</a></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2022/05/26/628fa0426213d.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/data.github.io/post/93b2f74a.html" title="mavros"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/05/26/628fa0426213d.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-09</div><div class="title">mavros</div></div></a></div><div><a href="/data.github.io/post/5d3e3d8b.html" title="soildworks"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/06/05/629c5257753d1.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-27</div><div class="title">soildworks</div></div></a></div><div><a href="/data.github.io/post/b7b02208.html" title="变结构无人机仿真"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/06/05/629c5257753d1.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-11</div><div class="title">变结构无人机仿真</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://wjlpicture.oss-cn-beijing.aliyuncs.com/img/12.png" onerror="this.onerror=null;this.src='/data.github.io/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">醉卿枫</div><div class="author-info__description">学习记录</div></div><div class="card-info-data site-data is-center"><a href="/data.github.io/archives/"><div class="headline">文章</div><div class="length-num">38</div></a><a href="/data.github.io/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/data.github.io/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">qq:2771329872</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ROS-%E6%A6%82%E5%BF%B5"><span class="toc-number">1.</span> <span class="toc-text">ROS 概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ROS-%E6%90%9E%E6%87%82%E5%A4%9A%E8%AF%9D%E9%A2%98%E5%9B%9E%E8%B0%83%E6%9C%BA%E5%88%B6%E4%BB%A5%E5%8F%8A%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"><span class="toc-number">1.1.</span> <span class="toc-text">ROS 搞懂多话题回调机制以及消息队列</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ROS%E6%97%B6%E9%97%B4%E6%A6%82%E5%BF%B5"><span class="toc-number">1.2.</span> <span class="toc-text">ROS时间概念</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ROS-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8%EF%BC%88%E6%93%8D%E4%BD%9C%E9%9B%86%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">ROS 命令行工具的使用（操作集）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ros%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">2.1.</span> <span class="toc-text">ros文件系统</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">2.2.</span> <span class="toc-text">常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#rosnode"><span class="toc-number">2.2.1.</span> <span class="toc-text">rosnode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rostopic"><span class="toc-number">2.2.2.</span> <span class="toc-text">rostopic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rosmsg"><span class="toc-number">2.2.3.</span> <span class="toc-text">rosmsg</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rosservice"><span class="toc-number">2.2.4.</span> <span class="toc-text">rosservice</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rosbag"><span class="toc-number">2.2.5.</span> <span class="toc-text">rosbag</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%97%B4%E4%B8%8E%E5%8A%9F%E8%83%BD%E5%8C%85"><span class="toc-number">3.</span> <span class="toc-text">创建工作空间与功能包</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#catkin-make%E5%92%8Ccatkin-build%E5%8C%BA%E5%88%AB"><span class="toc-number">3.0.0.1.</span> <span class="toc-text">catkin_make和catkin build区别</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.1.</span> <span class="toc-text">发布实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cmake%E6%96%87%E4%BB%B6"><span class="toc-number">3.1.1.</span> <span class="toc-text">cmake文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A2%E9%98%85%E8%80%85%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.2.</span> <span class="toc-text">订阅者实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%E4%BC%A0%E5%85%A5%E5%A4%9A%E4%B8%AA%E5%8F%82%E6%95%B0"><span class="toc-number">3.2.0.1.</span> <span class="toc-text">回调函数传入多个参数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A2%E9%98%85%E5%92%8C%E5%8F%91%E5%B8%83%E6%B7%B7%E7%94%A8"><span class="toc-number">3.2.1.</span> <span class="toc-text">订阅和发布混用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#python%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.3.</span> <span class="toc-text">python实现</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%9D%E9%A2%98%E6%B6%88%E6%81%AF%E7%9A%84%E5%AE%9A%E4%B9%89%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="toc-number">4.</span> <span class="toc-text">话题消息的定义与使用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.</span> <span class="toc-text">客户端实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.</span> <span class="toc-text">服务端实现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AE%9A%E4%B9%89%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="toc-number">6.1.</span> <span class="toc-text">服务数据的定义与使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E4%BD%BF%E7%94%A8%E4%B8%8E%E7%BC%96%E7%A8%8B%E6%96%B9%E6%B3%95"><span class="toc-number">6.2.</span> <span class="toc-text">参数使用与编程方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%BA%E5%88%AB"><span class="toc-number">6.3.</span> <span class="toc-text">区别</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9D%90%E6%A0%87%E7%B3%BB%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="toc-number">7.</span> <span class="toc-text">坐标系管理系统</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#launch%E5%90%AF%E5%8A%A8%E6%96%87%E4%BB%B6"><span class="toc-number">8.</span> <span class="toc-text">launch启动文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#launch%E5%85%83%E7%B4%A0"><span class="toc-number">8.1.</span> <span class="toc-text">launch元素</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#node%E5%85%83%E7%B4%A0"><span class="toc-number">8.2.</span> <span class="toc-text">node元素</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#param%E5%85%83%E7%B4%A0"><span class="toc-number">8.3.</span> <span class="toc-text">param元素</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90%E8%AE%B2%E8%A7%A3"><span class="toc-number">8.3.1.</span> <span class="toc-text">例子讲解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#group%E5%85%83%E7%B4%A0"><span class="toc-number">8.4.</span> <span class="toc-text">group元素</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#include%E5%85%83%E7%B4%A0"><span class="toc-number">8.5.</span> <span class="toc-text">include元素</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#roslaunch%E4%B8%AD%E7%9A%84%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE%E9%80%89%E9%A1%B9"><span class="toc-number">8.6.</span> <span class="toc-text">roslaunch中的高级配置选项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8remap%E6%A0%87%E7%AD%BE%E8%BF%9B%E8%A1%8C%E8%AF%9D%E9%A2%98%E9%87%8D%E6%98%A0%E5%B0%84"><span class="toc-number">8.6.1.</span> <span class="toc-text">使用remap标签进行话题重映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5%E5%8F%82%E6%95%B0%E5%B9%B6%E4%BD%BF%E7%94%A8arg%E6%A0%87%E7%AD%BE"><span class="toc-number">8.6.2.</span> <span class="toc-text">引入参数并使用arg标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E5%90%AF%E5%8A%A8%E8%8A%82%E7%82%B9%EF%BC%9A%E4%BD%BF%E7%94%A8if%E5%92%8Cunless%E8%AF%AD%E5%8F%A5"><span class="toc-number">8.6.3.</span> <span class="toc-text">条件启动节点：使用if和unless语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90"><span class="toc-number">8.7.</span> <span class="toc-text">例子</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sh%E8%84%9A%E6%9C%AC%E6%96%87%E4%BB%B6%E5%90%AF%E5%8A%A8"><span class="toc-number">9.</span> <span class="toc-text">.sh脚本文件启动</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E8%AF%B4%E6%98%8E"><span class="toc-number">9.1.</span> <span class="toc-text">语法说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B"><span class="toc-number">9.2.</span> <span class="toc-text">流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B"><span class="toc-number">9.2.1.</span> <span class="toc-text">实例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ROS-INFO"><span class="toc-number">10.</span> <span class="toc-text">ROS_INFO</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/data.github.io/post/52d1a938.html" title="8.c++_线程"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/06/05/629c5257753d1.png" onerror="this.onerror=null;this.src='/data.github.io/img/404.jpg'" alt="8.c++_线程"/></a><div class="content"><a class="title" href="/data.github.io/post/52d1a938.html" title="8.c++_线程">8.c++_线程</a><time datetime="2023-12-24T16:00:00.000Z" title="发表于 2023-12-25 00:00:00">2023-12-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/data.github.io/post/861cd88b.html" title="7.c+++_智能指针_文件操作"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/06/05/629c5257753d1.png" onerror="this.onerror=null;this.src='/data.github.io/img/404.jpg'" alt="7.c+++_智能指针_文件操作"/></a><div class="content"><a class="title" href="/data.github.io/post/861cd88b.html" title="7.c+++_智能指针_文件操作">7.c+++_智能指针_文件操作</a><time datetime="2023-12-23T16:00:00.000Z" title="发表于 2023-12-24 00:00:00">2023-12-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/data.github.io/post/6ad37afc.html" title="6.c++_STL"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/05/26/628fa0426213d.png" onerror="this.onerror=null;this.src='/data.github.io/img/404.jpg'" alt="6.c++_STL"/></a><div class="content"><a class="title" href="/data.github.io/post/6ad37afc.html" title="6.c++_STL">6.c++_STL</a><time datetime="2023-12-20T16:00:00.000Z" title="发表于 2023-12-21 00:00:00">2023-12-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/data.github.io/post/b7b02208.html" title="变结构无人机仿真"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/06/05/629c5257753d1.png" onerror="this.onerror=null;this.src='/data.github.io/img/404.jpg'" alt="变结构无人机仿真"/></a><div class="content"><a class="title" href="/data.github.io/post/b7b02208.html" title="变结构无人机仿真">变结构无人机仿真</a><time datetime="2023-11-10T16:00:00.000Z" title="发表于 2023-11-11 00:00:00">2023-11-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/data.github.io/post/5d3e3d8b.html" title="soildworks"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/06/05/629c5257753d1.png" onerror="this.onerror=null;this.src='/data.github.io/img/404.jpg'" alt="soildworks"/></a><div class="content"><a class="title" href="/data.github.io/post/5d3e3d8b.html" title="soildworks">soildworks</a><time datetime="2023-10-27T13:01:00.000Z" title="发表于 2023-10-27 21:01:00">2023-10-27</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://bu.dusays.com/2022/05/26/628fa0426213d.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 醉卿枫</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/data.github.io/js/utils.js"></script><script src="/data.github.io/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/data.github.io/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/data.github.io/js/search/local-search.js"></script></div></div></body></html>